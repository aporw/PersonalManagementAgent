{"ast":null,"code":"var _jsxFileName = \"/Users/ankurporwal/Documents/AIConsultation/Frontend/src/components/chat/ChatPanel.tsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction makeId(prefix = \"m\") {\n  return `${prefix}${Date.now()}${Math.floor(Math.random() * 1000)}`;\n}\nexport default function ChatPanel({\n  activeThread,\n  session,\n  preferences\n}) {\n  _s();\n  var _activeThread$title;\n  // API base: allow overriding via `REACT_APP_API_BASE` (create-react-app) or window.API_BASE\n  const API_BASE = typeof window !== \"undefined\" && window.API_BASE || process.env.REACT_APP_API_BASE || \"http://localhost:8000\";\n  const DEBUG = true; // set to true temporarily to log network/stream activity\n\n  const [input, setInput] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const [sending, setSending] = useState(false);\n  const abortRef = useRef(null);\n  useEffect(() => {\n    if (session !== null && session !== void 0 && session.messages && Array.isArray(session.messages)) {\n      const mapped = session.messages.map(m => {\n        var _m$role, _ref, _m$content, _m$created_at;\n        return {\n          id: m.entry_id ? String(m.entry_id) : makeId(\"s\"),\n          role: (_m$role = m.role) !== null && _m$role !== void 0 ? _m$role : m.source === \"assistant\" ? \"assistant\" : \"user\",\n          content: (_ref = (_m$content = m.content) !== null && _m$content !== void 0 ? _m$content : m.text) !== null && _ref !== void 0 ? _ref : \"\",\n          created_at: (_m$created_at = m.created_at) !== null && _m$created_at !== void 0 ? _m$created_at : undefined\n        };\n      });\n      setMessages(mapped);\n    } else {\n      setMessages([]);\n    }\n  }, [session]);\n  function updateMessage(id, patch) {\n    setMessages(prev => prev.map(m => m.id === id ? {\n      ...m,\n      ...patch\n    } : m));\n  }\n  function pushMessage(msg) {\n    setMessages(prev => [...prev, msg]);\n  }\n  async function handleSend() {\n    var _activeThread$thread_;\n    const text = input.trim();\n    if (!text || sending) return;\n    const userMsg = {\n      id: makeId(\"u\"),\n      role: \"user\",\n      content: text,\n      created_at: new Date().toISOString()\n    };\n    pushMessage(userMsg);\n    setInput(\"\");\n    const userId = localStorage.getItem(\"user_id\") || \"u1\";\n    const threadId = (_activeThread$thread_ = activeThread === null || activeThread === void 0 ? void 0 : activeThread.thread_id) !== null && _activeThread$thread_ !== void 0 ? _activeThread$thread_ : \"t1\";\n    try {\n      void fetch(`${API_BASE}/message`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          user_id: userId,\n          thread_id: threadId,\n          role: \"user\",\n          content: text\n        })\n      });\n    } catch (e) {\n      // ignore\n    }\n    const assistantId = makeId(\"a\");\n    const assistantPlaceholder = {\n      id: assistantId,\n      role: \"assistant\",\n      content: \"\",\n      created_at: new Date().toISOString(),\n      streaming: true\n    };\n    pushMessage(assistantPlaceholder);\n    if (abortRef.current) abortRef.current.abort();\n    const ac = new AbortController();\n    abortRef.current = ac;\n    setSending(true);\n    try {\n      // request streaming via query param so backend returns SSE (text/event-stream)\n      const res = await fetch(`${API_BASE}/chat?stream=true`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"text/event-stream\"\n        },\n        body: JSON.stringify({\n          user_id: userId,\n          thread_id: threadId,\n          message: text\n        }),\n        signal: ac.signal\n      });\n      if (DEBUG) console.debug(\"/chat response status\", res.status, res.headers.get(\"content-type\"));\n      if (!res.ok) {\n        let fallbackText = `Assistant error (${res.status})`;\n        try {\n          var _ref2, _json$reply;\n          const json = await res.json();\n          fallbackText = (_ref2 = (_json$reply = json === null || json === void 0 ? void 0 : json.reply) !== null && _json$reply !== void 0 ? _json$reply : json === null || json === void 0 ? void 0 : json.message) !== null && _ref2 !== void 0 ? _ref2 : fallbackText;\n        } catch (e) {\n          // ignore\n        }\n        updateMessage(assistantId, {\n          content: getFakeResponse(text, preferences) + `\\n\\n(${fallbackText})`,\n          streaming: false\n        });\n        return;\n      }\n      if (res.body && typeof res.body.getReader === \"function\") {\n        // backend returns SSE frames like: data: {\"delta\":\"...\"}\\n\\n\n        const reader = res.body.getReader();\n        const decoder = new TextDecoder();\n        let sseBuffer = \"\";\n        let accumulated = \"\";\n        let done = false;\n        while (!done) {\n          const {\n            value,\n            done: d\n          } = await reader.read();\n          if (d) {\n            done = true;\n            if (DEBUG) console.debug(\"stream reader signalled done\");\n          }\n          if (value) {\n            const chunkStr = decoder.decode(value, {\n              stream: true\n            });\n            if (DEBUG) console.debug(\"stream chunk:\", chunkStr.slice(0, 200));\n            sseBuffer += chunkStr;\n\n            // process complete SSE events separated by double-newline\n            let sepIndex;\n            while ((sepIndex = sseBuffer.indexOf(\"\\n\\n\")) !== -1) {\n              const rawEvent = sseBuffer.slice(0, sepIndex);\n              sseBuffer = sseBuffer.slice(sepIndex + 2);\n\n              // lines inside an event\n              const lines = rawEvent.split(/\\r?\\n/);\n              for (const line of lines) {\n                const trimmed = line.trim();\n                if (!trimmed) continue;\n                if (trimmed.startsWith(\"data:\")) {\n                  const payload = trimmed.slice(5).trim();\n                  if (payload === \"[DONE]\") {\n                    done = true;\n                    break;\n                  }\n                  try {\n                    var _obj$delta;\n                    const obj = JSON.parse(payload);\n                    const delta = (_obj$delta = obj === null || obj === void 0 ? void 0 : obj.delta) !== null && _obj$delta !== void 0 ? _obj$delta : \"\";\n                    if (delta) {\n                      accumulated += delta;\n                      if (DEBUG) console.debug(\"delta appended:\", delta.slice(0, 200));\n                      updateMessage(assistantId, {\n                        content: accumulated,\n                        streaming: true\n                      });\n                    }\n                  } catch (e) {\n                    // if not JSON, append raw payload\n                    accumulated += payload;\n                    if (DEBUG) console.debug(\"raw payload appended:\", payload.slice(0, 200));\n                    updateMessage(assistantId, {\n                      content: accumulated,\n                      streaming: true\n                    });\n                  }\n                }\n              }\n            }\n          }\n        }\n        if (DEBUG) console.debug(\"stream finished, total accumulated length\", accumulated.length);\n        updateMessage(assistantId, {\n          content: accumulated,\n          streaming: false\n        });\n      } else {\n        var _ref3, _data$reply;\n        const data = await res.json();\n        if (DEBUG) console.debug(\"non-stream response json\", data);\n        const reply = (_ref3 = (_data$reply = data === null || data === void 0 ? void 0 : data.reply) !== null && _data$reply !== void 0 ? _data$reply : data === null || data === void 0 ? void 0 : data.message) !== null && _ref3 !== void 0 ? _ref3 : getFakeResponse(text, preferences);\n        updateMessage(assistantId, {\n          content: reply,\n          streaming: false\n        });\n      }\n      try {\n        var _messages$find$conten, _messages$find;\n        void fetch(`${API_BASE}/message`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            user_id: userId,\n            thread_id: threadId,\n            role: \"assistant\",\n            content: (_messages$find$conten = (_messages$find = messages.find(m => m.id === assistantId)) === null || _messages$find === void 0 ? void 0 : _messages$find.content) !== null && _messages$find$conten !== void 0 ? _messages$find$conten : \"\"\n          })\n        });\n      } catch (e) {\n        // ignore\n      }\n    } catch (err) {\n      if ((err === null || err === void 0 ? void 0 : err.name) === \"AbortError\") {\n        updateMessage(assistantId, {\n          content: \"(stream aborted)\",\n          streaming: false\n        });\n      } else {\n        updateMessage(assistantId, {\n          content: getFakeResponse(text, preferences) + \" (offline fallback)\",\n          streaming: false\n        });\n      }\n    } finally {\n      setSending(false);\n      abortRef.current = null;\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-panel\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header\",\n      children: /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: (_activeThread$title = activeThread === null || activeThread === void 0 ? void 0 : activeThread.title) !== null && _activeThread$title !== void 0 ? _activeThread$title : \"Thinking space\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"messages\",\n      \"aria-live\": \"polite\",\n      children: messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `msg ${m.role}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"msg-meta\",\n          style: {\n            fontSize: 12,\n            color: \"#666\"\n          },\n          children: [m.role, m.created_at ? ` • ${new Date(m.created_at).toLocaleTimeString()}` : \"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n          style: {\n            whiteSpace: \"pre-wrap\",\n            margin: 0\n          },\n          children: m.content\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, this), m.streaming && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: \"#666\"\n          },\n          children: \"Streaming\\u2026\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 29\n        }, this)]\n      }, m.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-input\",\n      style: {\n        display: \"flex\",\n        gap: 8,\n        marginTop: 8,\n        alignItems: 'flex-start'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n        id: \"chat-input\",\n        name: \"chat_input\",\n        \"aria-label\": \"Chat input\",\n        value: input,\n        placeholder: \"Think out loud\\u2026\",\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => {\n          // Enter sends (unless Shift+Enter)\n          if (e.key === \"Enter\" && !e.shiftKey) {\n            e.preventDefault();\n            handleSend();\n          }\n        },\n        style: {\n          flex: 1,\n          minHeight: 80\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSend,\n          disabled: sending || !input.trim(),\n          style: {\n            minWidth: 100\n          },\n          children: sending ? \"Sending…\" : \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            if (abortRef.current) abortRef.current.abort();\n          },\n          disabled: !abortRef.current,\n          style: {\n            minWidth: 100\n          },\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"prompt-btn\",\n        onClick: async () => {\n          if (!activeThread) return;\n          if (!window.confirm(\"Delete this chat history for the selected thread?\")) return;\n          const userId = localStorage.getItem(\"user_id\") || \"u1\";\n          try {\n            const resp = await fetch(`${API_BASE}/messages/${encodeURIComponent(userId)}/${encodeURIComponent(activeThread.thread_id)}`, {\n              method: \"DELETE\",\n              headers: {\n                \"Content-Type\": \"application/json\"\n              }\n            });\n            if (!resp.ok) {\n              const body = await resp.text().catch(() => \"\");\n              alert(\"Failed to delete chat: \" + resp.status + \" \" + body);\n              return;\n            }\n            // clear local messages\n            setMessages([]);\n            // also inform user\n            alert(\"Chat history deleted.\");\n          } catch (e) {\n            alert(\"Delete failed: \" + String(e));\n          }\n        },\n        children: \"Delete Chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 191,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPanel, \"cAEVs4fzRBBP7rsEoRSOMP6Xizw=\");\n_c = ChatPanel;\nfunction getFakeResponse(input, preferences) {\n  if (!preferences) return \"I’m here to listen.\";\n  if (preferences.default_tone === \"direct\") {\n    return \"Let’s simplify this. What decision are you actually trying to make?\";\n  }\n  if (preferences.depth_level === \"deep\") {\n    return \"Let me reflect this back. It sounds like you’re torn between safety and growth. What’s driving that tension right now?\";\n  }\n  return \"I’m hearing a few competing thoughts here. Want to slow down and look at them one by one?\";\n}\nvar _c;\n$RefreshReg$(_c, \"ChatPanel\");","map":{"version":3,"names":["useEffect","useRef","useState","jsxDEV","_jsxDEV","makeId","prefix","Date","now","Math","floor","random","ChatPanel","activeThread","session","preferences","_s","_activeThread$title","API_BASE","window","process","env","REACT_APP_API_BASE","DEBUG","input","setInput","messages","setMessages","sending","setSending","abortRef","Array","isArray","mapped","map","m","_m$role","_ref","_m$content","_m$created_at","id","entry_id","String","role","source","content","text","created_at","undefined","updateMessage","patch","prev","pushMessage","msg","handleSend","_activeThread$thread_","trim","userMsg","toISOString","userId","localStorage","getItem","threadId","thread_id","fetch","method","headers","body","JSON","stringify","user_id","e","assistantId","assistantPlaceholder","streaming","current","abort","ac","AbortController","res","Accept","message","signal","console","debug","status","get","ok","fallbackText","_ref2","_json$reply","json","reply","getFakeResponse","getReader","reader","decoder","TextDecoder","sseBuffer","accumulated","done","value","d","read","chunkStr","decode","stream","slice","sepIndex","indexOf","rawEvent","lines","split","line","trimmed","startsWith","payload","_obj$delta","obj","parse","delta","length","_ref3","_data$reply","data","_messages$find$conten","_messages$find","find","err","name","className","children","title","fileName","_jsxFileName","lineNumber","columnNumber","style","fontSize","color","toLocaleTimeString","whiteSpace","margin","display","gap","marginTop","alignItems","placeholder","onChange","target","onKeyDown","key","shiftKey","preventDefault","flex","minHeight","flexDirection","onClick","disabled","minWidth","confirm","resp","encodeURIComponent","catch","alert","_c","default_tone","depth_level","$RefreshReg$"],"sources":["/Users/ankurporwal/Documents/AIConsultation/Frontend/src/components/chat/ChatPanel.tsx"],"sourcesContent":["import { Thread, Session, UserPreferences } from \"../../types/thinking\";\nimport { useEffect, useRef, useState } from \"react\";\n\ninterface ChatPanelProps {\n  activeThread?: Thread | null;\n  session?: Session | null;\n  preferences: UserPreferences;\n}\n\ntype Message = {\n  id: string;\n  role: \"user\" | \"assistant\" | \"system\";\n  content: string;\n  created_at?: string;\n  streaming?: boolean;\n};\n\nfunction makeId(prefix = \"m\") {\n  return `${prefix}${Date.now()}${Math.floor(Math.random() * 1000)}`;\n}\n\nexport default function ChatPanel({ activeThread, session, preferences }: ChatPanelProps) {\n  // API base: allow overriding via `REACT_APP_API_BASE` (create-react-app) or window.API_BASE\n  const API_BASE = (typeof window !== \"undefined\" && (window as any).API_BASE) || (process.env.REACT_APP_API_BASE as string) || \"http://localhost:8000\";\n  const DEBUG = true; // set to true temporarily to log network/stream activity\n\n  const [input, setInput] = useState(\"\");\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [sending, setSending] = useState(false);\n  const abortRef = useRef<AbortController | null>(null);\n\n  useEffect(() => {\n    if (session?.messages && Array.isArray(session.messages)) {\n      const mapped = session.messages.map((m: any) => ({\n        id: m.entry_id ? String(m.entry_id) : makeId(\"s\"),\n        role: m.role ?? (m.source === \"assistant\" ? \"assistant\" : \"user\"),\n        content: m.content ?? m.text ?? \"\",\n        created_at: m.created_at ?? undefined,\n      }));\n      setMessages(mapped);\n    } else {\n      setMessages([]);\n    }\n  }, [session]);\n\n  function updateMessage(id: string, patch: Partial<Message>) {\n    setMessages((prev) => prev.map((m) => (m.id === id ? { ...m, ...patch } : m)));\n  }\n\n  function pushMessage(msg: Message) {\n    setMessages((prev) => [...prev, msg]);\n  }\n\n  async function handleSend() {\n    const text = input.trim();\n    if (!text || sending) return;\n\n    const userMsg: Message = { id: makeId(\"u\"), role: \"user\", content: text, created_at: new Date().toISOString() };\n    pushMessage(userMsg);\n    setInput(\"\");\n\n    const userId = localStorage.getItem(\"user_id\") || \"u1\";\n    const threadId = activeThread?.thread_id ?? \"t1\";\n\n    try {\n      void fetch(`${API_BASE}/message`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ user_id: userId, thread_id: threadId, role: \"user\", content: text }),\n      });\n    } catch (e) {\n      // ignore\n    }\n\n    const assistantId = makeId(\"a\");\n    const assistantPlaceholder: Message = { id: assistantId, role: \"assistant\", content: \"\", created_at: new Date().toISOString(), streaming: true };\n    pushMessage(assistantPlaceholder);\n\n    if (abortRef.current) abortRef.current.abort();\n    const ac = new AbortController();\n    abortRef.current = ac;\n\n    setSending(true);\n    try {\n    // request streaming via query param so backend returns SSE (text/event-stream)\n      const res = await fetch(`${API_BASE}/chat?stream=true`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", Accept: \"text/event-stream\" },\n        body: JSON.stringify({ user_id: userId, thread_id: threadId, message: text }),\n        signal: ac.signal,\n      });\n\n      if (DEBUG) console.debug(\"/chat response status\", res.status, res.headers.get(\"content-type\"));\n      if (!res.ok) {\n        let fallbackText = `Assistant error (${res.status})`;\n        try {\n          const json = await res.json();\n          fallbackText = json?.reply ?? json?.message ?? fallbackText;\n        } catch (e) {\n          // ignore\n        }\n        updateMessage(assistantId, { content: getFakeResponse(text, preferences) + `\\n\\n(${fallbackText})`, streaming: false });\n        return;\n      }\n\n      if (res.body && typeof res.body.getReader === \"function\") {\n        // backend returns SSE frames like: data: {\"delta\":\"...\"}\\n\\n\n        const reader = res.body.getReader();\n        const decoder = new TextDecoder();\n        let sseBuffer = \"\";\n        let accumulated = \"\";\n        let done = false;\n        while (!done) {\n          const { value, done: d } = await reader.read();\n          if (d) {\n            done = true;\n            if (DEBUG) console.debug(\"stream reader signalled done\");\n          }\n          if (value) {\n            const chunkStr = decoder.decode(value, { stream: true });\n            if (DEBUG) console.debug(\"stream chunk:\", chunkStr.slice(0, 200));\n            sseBuffer += chunkStr;\n\n            // process complete SSE events separated by double-newline\n            let sepIndex;\n            while ((sepIndex = sseBuffer.indexOf(\"\\n\\n\")) !== -1) {\n              const rawEvent = sseBuffer.slice(0, sepIndex);\n              sseBuffer = sseBuffer.slice(sepIndex + 2);\n\n              // lines inside an event\n              const lines = rawEvent.split(/\\r?\\n/);\n              for (const line of lines) {\n                const trimmed = line.trim();\n                if (!trimmed) continue;\n                if (trimmed.startsWith(\"data:\")) {\n                  const payload = trimmed.slice(5).trim();\n                  if (payload === \"[DONE]\") {\n                    done = true;\n                    break;\n                  }\n                    try {\n                      const obj = JSON.parse(payload);\n                      const delta = obj?.delta ?? \"\";\n                      if (delta) {\n                        accumulated += delta;\n                        if (DEBUG) console.debug(\"delta appended:\", delta.slice(0,200));\n                        updateMessage(assistantId, { content: accumulated, streaming: true });\n                      }\n                    } catch (e) {\n                      // if not JSON, append raw payload\n                      accumulated += payload;\n                      if (DEBUG) console.debug(\"raw payload appended:\", payload.slice(0,200));\n                      updateMessage(assistantId, { content: accumulated, streaming: true });\n                    }\n                }\n              }\n            }\n          }\n        }\n        if (DEBUG) console.debug(\"stream finished, total accumulated length\", accumulated.length);\n        updateMessage(assistantId, { content: accumulated, streaming: false });\n      } else {\n        const data = await res.json();\n        if (DEBUG) console.debug(\"non-stream response json\", data);\n        const reply = data?.reply ?? data?.message ?? getFakeResponse(text, preferences);\n        updateMessage(assistantId, { content: reply, streaming: false });\n      }\n\n      try {\n        void fetch(`${API_BASE}/message`, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ user_id: userId, thread_id: threadId, role: \"assistant\", content: messages.find((m) => m.id === assistantId)?.content ?? \"\" }),\n        });\n      } catch (e) {\n        // ignore\n      }\n    } catch (err: any) {\n      if (err?.name === \"AbortError\") {\n        updateMessage(assistantId, { content: \"(stream aborted)\", streaming: false });\n      } else {\n        updateMessage(assistantId, { content: getFakeResponse(text, preferences) + \" (offline fallback)\", streaming: false });\n      }\n    } finally {\n      setSending(false);\n      abortRef.current = null;\n    }\n  }\n\n  return (\n    <div className=\"chat-panel\">\n      <div className=\"chat-header\">\n        <h3>{activeThread?.title ?? \"Thinking space\"}</h3>\n      </div>\n\n      <div className=\"messages\" aria-live=\"polite\">\n        {messages.map((m) => (\n          <div key={m.id} className={`msg ${m.role}`}>\n            <div className=\"msg-meta\" style={{ fontSize: 12, color: \"#666\" }}>\n              {m.role}\n              {m.created_at ? ` • ${new Date(m.created_at).toLocaleTimeString()}` : \"\"}\n            </div>\n            <pre style={{ whiteSpace: \"pre-wrap\", margin: 0 }}>{m.content}</pre>\n            {m.streaming && <div style={{ fontSize: 12, color: \"#666\" }}>Streaming…</div>}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"chat-input\" style={{ display: \"flex\", gap: 8, marginTop: 8, alignItems: 'flex-start' }}>\n        <textarea\n          id=\"chat-input\"\n          name=\"chat_input\"\n          aria-label=\"Chat input\"\n          value={input}\n          placeholder=\"Think out loud…\"\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => {\n            // Enter sends (unless Shift+Enter)\n            if (e.key === \"Enter\" && !e.shiftKey) {\n              e.preventDefault();\n              handleSend();\n            }\n          }}\n          style={{ flex: 1, minHeight: 80 }}\n        />\n        <div style={{ display: \"flex\", flexDirection: \"column\", gap: 8 }}>\n          <button onClick={handleSend} disabled={sending || !input.trim()} style={{ minWidth: 100 }}>\n            {sending ? \"Sending…\" : \"Send\"}\n          </button>\n          <button\n            onClick={() => {\n              if (abortRef.current) abortRef.current.abort();\n            }}\n            disabled={!abortRef.current}\n            style={{ minWidth: 100 }}\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n\n      <div style={{ marginTop: 8 }}>\n        <button\n          className=\"prompt-btn\"\n          onClick={async () => {\n            if (!activeThread) return;\n            if (!window.confirm(\"Delete this chat history for the selected thread?\")) return;\n            const userId = localStorage.getItem(\"user_id\") || \"u1\";\n            try {\n              const resp = await fetch(`${API_BASE}/messages/${encodeURIComponent(userId)}/${encodeURIComponent(activeThread.thread_id)}`, {\n                method: \"DELETE\",\n                headers: { \"Content-Type\": \"application/json\" },\n              });\n              if (!resp.ok) {\n                const body = await resp.text().catch(() => \"\");\n                alert(\"Failed to delete chat: \" + resp.status + \" \" + body);\n                return;\n              }\n              // clear local messages\n              setMessages([]);\n              // also inform user\n              alert(\"Chat history deleted.\");\n            } catch (e) {\n              alert(\"Delete failed: \" + String(e));\n            }\n          }}\n        >\n          Delete Chat\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction getFakeResponse(input: string, preferences?: UserPreferences): string {\n  if (!preferences) return \"I’m here to listen.\";\n  if ((preferences as any).default_tone === \"direct\") {\n    return \"Let’s simplify this. What decision are you actually trying to make?\";\n  }\n  if ((preferences as any).depth_level === \"deep\") {\n    return \"Let me reflect this back. It sounds like you’re torn between safety and growth. What’s driving that tension right now?\";\n  }\n  return \"I’m hearing a few competing thoughts here. Want to slow down and look at them one by one?\";\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}