{"ast":null,"code":"var _jsxFileName = \"/Users/ankurporwal/Documents/AIConsultation/Frontend/src/components/layout/RightPanel.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useEffect, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { journalEntries as seededJournal } from \"../../data/journal\";\nimport \"./RightPanel.css\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst MODE_HINTS = {\n  exploring_options: {\n    label: \"Exploration\",\n    description: \"Exploring options and clarifying ideas.\",\n    suggestions: [\"Ask why this problem matters\", \"Challenge your assumptions\", \"Explore alternative angles\"]\n  },\n  overwhelmed: {\n    label: \"Overwhelmed\",\n    description: \"You're feeling overloaded or uncertain about where to start.\",\n    suggestions: [\"Identify the smallest next step\", \"Prioritize ruthlessly\", \"Take a short break and return with fresh eyes\"]\n  },\n  reflective: {\n    label: \"Reflection\",\n    description: \"You're processing past actions or thoughts.\",\n    suggestions: [\"What worked well?\", \"What would you change?\", \"What pattern do you notice?\"]\n  },\n  decisive: {\n    label: \"Decision Making\",\n    description: \"You're evaluating options and moving toward a choice.\",\n    suggestions: [\"List pros and cons\", \"Define success criteria\", \"Identify irreversible decisions\"]\n  }\n};\nexport default function RightPanel({\n  mode,\n  summary: propSummary = null,\n  threads = []\n}) {\n  _s();\n  var _threads$0$thread_id, _threads$, _entries$, _ref, _ref2, _fetchedSummary$curre3, _fetchedSummary$what_3, _propSummary$key_poin, _fetchedSummary$sugge3;\n  const modeConfig = mode ? MODE_HINTS[mode] : null;\n\n  // API base: allow overriding via `REACT_APP_API_BASE` or window.API_BASE\n  const API_BASE = typeof window !== \"undefined\" && window.API_BASE || process.env.REACT_APP_API_BASE || \"http://localhost:8000\";\n  const [openFull, setOpenFull] = useState(false);\n  const [entries, setEntries] = useState([]);\n  const [selectedEntry, setSelectedEntry] = useState(null);\n  const [modalWidth, setModalWidth] = useState(75); // vw\n  const [showNewForm, setShowNewForm] = useState(false);\n  const [newTitle, setNewTitle] = useState(\"\");\n  const [newContent, setNewContent] = useState(\"\");\n  const [fontChoice, setFontChoice] = useState(\"Patrick Hand\");\n\n  // editing state\n  const [editingEntryId, setEditingEntryId] = useState(null);\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [editContent, setEditContent] = useState(\"\");\n\n  // summary / threads\n  const [selectedThreadId, setSelectedThreadId] = useState((_threads$0$thread_id = threads === null || threads === void 0 ? void 0 : (_threads$ = threads[0]) === null || _threads$ === void 0 ? void 0 : _threads$.thread_id) !== null && _threads$0$thread_id !== void 0 ? _threads$0$thread_id : \"t1\");\n  const [loadingSummary, setLoadingSummary] = useState(false);\n  const [fetchedSummary, setFetchedSummary] = useState({});\n  const [editingSection, setEditingSection] = useState(null);\n  const [draftCurrent, setDraftCurrent] = useState(undefined);\n  const [draftUncovered, setDraftUncovered] = useState(undefined);\n  const [draftSuggested, setDraftSuggested] = useState(undefined);\n  const [recentlyAdded, setRecentlyAdded] = useState(null);\n  const undoTimerRef = useRef(null);\n  const EDIT_KEY_PREFIX = \"ai_edited_summary_\";\n  function loadEditedSummary(threadId) {\n    try {\n      const key = `${EDIT_KEY_PREFIX}${threadId}`;\n      const raw = localStorage.getItem(key);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      return parsed;\n    } catch (e) {\n      return null;\n    }\n  }\n  function persistEditedSummary(threadId, data) {\n    try {\n      const key = `${EDIT_KEY_PREFIX}${threadId}`;\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  // load entries from localStorage or seeded\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(\"ai_journal_entries\");\n      if (raw) {\n        setEntries(JSON.parse(raw));\n      } else {\n        setEntries(seededJournal);\n      }\n    } catch (e) {\n      setEntries(seededJournal);\n    }\n  }, []);\n\n  // persist helper\n  function persistEntries(next) {\n    setEntries(next);\n    try {\n      localStorage.setItem(\"ai_journal_entries\", JSON.stringify(next));\n    } catch (e) {\n      /* ignore */\n    }\n  }\n  function startEdit(entry) {\n    setSelectedEntry(entry);\n    setEditingEntryId(entry.entry_id);\n    setEditTitle(entry.title);\n    setEditContent(entry.content);\n  }\n  function saveEdit(entryId) {\n    var _next$find;\n    const next = entries.map(en => en.entry_id === entryId ? {\n      ...en,\n      title: editTitle,\n      content: editContent\n    } : en);\n    persistEntries(next);\n    setEditingEntryId(null);\n    const updated = (_next$find = next.find(n => n.entry_id === entryId)) !== null && _next$find !== void 0 ? _next$find : null;\n    setSelectedEntry(updated);\n  }\n  function cancelEdit() {\n    setEditingEntryId(null);\n    setEditTitle(\"\");\n    setEditContent(\"\");\n  }\n  function deleteEntry(entryId) {\n    if (!window.confirm(\"Delete this journal entry?\")) return;\n    const next = entries.filter(e => e.entry_id !== entryId);\n    persistEntries(next);\n    if ((selectedEntry === null || selectedEntry === void 0 ? void 0 : selectedEntry.entry_id) === entryId) {\n      var _next$;\n      setSelectedEntry((_next$ = next[0]) !== null && _next$ !== void 0 ? _next$ : null);\n    }\n  }\n  const latestEntry = (_entries$ = entries[0]) !== null && _entries$ !== void 0 ? _entries$ : null;\n\n  // modal width + font choice persistence\n  useEffect(() => {\n    try {\n      const w = localStorage.getItem(\"ai_journal_modal_width\");\n      if (w) setModalWidth(Number(w));\n    } catch (e) {}\n  }, []);\n  useEffect(() => {\n    try {\n      const f = localStorage.getItem(\"ai_journal_font\");\n      if (f) setFontChoice(f);\n    } catch (e) {}\n  }, []);\n  useEffect(() => {\n    try {\n      localStorage.setItem(\"ai_journal_modal_width\", String(modalWidth));\n    } catch (e) {}\n  }, [modalWidth]);\n  useEffect(() => {\n    try {\n      localStorage.setItem(\"ai_journal_font\", fontChoice);\n    } catch (e) {}\n  }, [fontChoice]);\n\n  // keep selectedThreadId in sync if threads prop changes\n  useEffect(() => {\n    if (threads && threads.length > 0) {\n      setSelectedThreadId(s => s || threads[0].thread_id);\n    }\n  }, [threads]);\n\n  // --- Summary post-processing helpers (client-side truncation/formatting) ---\n  const limitSentences = (text, maxSentences = 3, maxWords = 40) => {\n    if (!text) return \"\";\n    const cleaned = String(text).replace(/\\s+/g, \" \").trim();\n    if (!cleaned) return \"\";\n    // split on end-of-sentence punctuation followed by space\n    const sentences = cleaned.split(/(?<=[.!?])\\s+/);\n    const taken = sentences.slice(0, maxSentences).join(' ');\n    const words = taken.split(/\\s+/).filter(Boolean);\n    if (words.length > maxWords) return words.slice(0, maxWords).join(' ') + '…';\n    return taken;\n  };\n  const extractListItems = text => {\n    if (!text) return [];\n    const normalized = String(text).replace(/\\r\\n/g, '\\n').trim();\n    if (!normalized) return [];\n    const lines = normalized.split(/\\n+/).map(l => l.trim()).filter(Boolean);\n    // detect explicit bullets or numbered lines\n    const bullets = lines.filter(l => /^[-•*]\\s+/.test(l) || /^\\d+[\\.\\)]\\s+/.test(l));\n    if (bullets.length) {\n      return bullets.map(l => l.replace(/^[-•*\\d\\.\\)\\s]+/, '').trim());\n    }\n    // fallback: split into sentences\n    const sentences = normalized.split(/(?<=[.!?])\\s+/).map(s => s.trim()).filter(Boolean);\n    if (sentences.length > 1) return sentences;\n    // fallback: split by semicolons or pipes\n    const parts = normalized.split(/[;|\\u2022]/).map(p => p.trim()).filter(Boolean);\n    return parts.length ? parts : [normalized];\n  };\n  const processCurrentState = text => {\n    // 2-3 short sentences, roughly capped to ~40 words\n    return limitSentences(text, 3, 40);\n  };\n  const processWhatWeUncovered = text => {\n    const items = extractListItems(text);\n    const take = items.slice(0, 3);\n    if (take.length === 0) return '';\n    // return as dash-list so renderRichText shows bullets\n    return take.map(it => `- ${it}`).join('\\n');\n  };\n  const processSuggestedNextSteps = text => {\n    const items = extractListItems(text);\n    const take = items.slice(0, 4).map(it => {\n      // keep only the short title before ':' or ' - '\n      const short = it.split(/[:\\-|–—]/)[0].trim();\n      // cap title length to reasonable words\n      const words = short.split(/\\s+/).slice(0, 12).join(' ');\n      return words;\n    });\n    if (take.length === 0) return '';\n    return take.map(t => `- ${t}`).join('\\n');\n  };\n  async function fetchSummaryForThread(threadId) {\n    // debounce guard: prevent repeat calls within short window (60s)\n    const now = Date.now();\n    if (lastFetchRef.current && now - lastFetchRef.current < 60000) {\n      window.dispatchEvent(new CustomEvent('ai_toast', {\n        detail: {\n          message: 'Please wait a moment before updating highlights again.',\n          kind: 'warn'\n        }\n      }));\n      return;\n    }\n    lastFetchRef.current = now;\n    setLoadingSummary(true);\n    const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n    try {\n      // fetch stored messages for the thread, then POST them to /summary so we explicitly pass the chat\n      const msgsRes = await fetch(`${API_BASE}/messages/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n      if (!msgsRes.ok) {\n        throw new Error(\"Failed to load messages\");\n      }\n      const msgsJson = await msgsRes.json();\n      const conversation = (msgsJson.messages || []).map(m => ({\n        role: m.role || \"user\",\n        content: m.content || \"\"\n      }));\n\n      // fetch any server-saved summary first so we can include it as prior context\n      let serverSavedSummary = {};\n      try {\n        const savedRes = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n        if (savedRes.ok) {\n          const sv = await savedRes.json();\n          serverSavedSummary = (sv === null || sv === void 0 ? void 0 : sv.summary) || {};\n        }\n      } catch (e) {\n        // ignore\n      }\n      const summaryRes = await fetch(`${API_BASE}/summary`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\"\n        },\n        body: JSON.stringify({\n          conversation,\n          last_summary: serverSavedSummary && (typeof serverSavedSummary === 'string' ? serverSavedSummary : JSON.stringify(serverSavedSummary))\n        })\n      });\n      if (!summaryRes.ok) {\n        // try to extract error details from the response body\n        let errBody = \"\";\n        try {\n          const t = await summaryRes.text();\n          errBody = t;\n        } catch (e) {\n          errBody = String(e);\n        }\n        console.error(\"summary error\", summaryRes.status, errBody);\n        setFetchedSummary({\n          current_state: `Error loading summary (${summaryRes.status}): ${errBody}`,\n          what_we_uncovered: \"\",\n          suggested_next_steps: \"\"\n        });\n      } else {\n        var _parsed$summary, _parsed$summary2, _parsed$summary3;\n        const data = await summaryRes.json();\n        // backend returns a JSON string in `summary` field (structured inside); handle both shapes\n        let parsed = {};\n        try {\n          parsed = typeof data.summary === \"string\" ? JSON.parse(data.summary) : data;\n        } catch (e) {\n          parsed = data;\n        }\n        const base = {\n          current_state: parsed.current_state || ((_parsed$summary = parsed.summary) === null || _parsed$summary === void 0 ? void 0 : _parsed$summary.current_state) || \"\",\n          what_we_uncovered: parsed.what_we_uncovered || ((_parsed$summary2 = parsed.summary) === null || _parsed$summary2 === void 0 ? void 0 : _parsed$summary2.what_we_uncovered) || \"\",\n          suggested_next_steps: parsed.suggested_next_steps || ((_parsed$summary3 = parsed.summary) === null || _parsed$summary3 === void 0 ? void 0 : _parsed$summary3.suggested_next_steps) || \"\"\n        };\n        // Normalize fields: backend may return arrays (for bullets) or strings.\n        const normalizeField = v => {\n          if (Array.isArray(v)) return v.join(\"\\n\");\n          if (v === null || v === undefined) return \"\";\n          return String(v);\n        };\n        const normBase = {\n          current_state: normalizeField(base.current_state),\n          what_we_uncovered: normalizeField(base.what_we_uncovered),\n          suggested_next_steps: normalizeField(base.suggested_next_steps)\n        };\n        // Post-process summary fields to keep outputs concise and readable\n        const processedBase = {\n          current_state: processCurrentState(normBase.current_state),\n          what_we_uncovered: processWhatWeUncovered(normBase.what_we_uncovered),\n          suggested_next_steps: processSuggestedNextSteps(normBase.suggested_next_steps)\n        };\n        // apply any locally edited overrides and server-saved overrides (edits override processed defaults)\n        const edited = loadEditedSummary(threadId) || {};\n        let merged = {\n          ...processedBase,\n          ...edited\n        };\n        try {\n          const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n          const savedRes = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n          if (savedRes.ok) {\n            const sv = await savedRes.json();\n            const serverSummary = (sv === null || sv === void 0 ? void 0 : sv.summary) || {};\n            // normalize server-saved fields as well (they might be arrays)\n            const serverNorm = {};\n            if (serverSummary.current_state !== undefined) serverNorm.current_state = normalizeField(serverSummary.current_state);\n            if (serverSummary.what_we_uncovered !== undefined) serverNorm.what_we_uncovered = normalizeField(serverSummary.what_we_uncovered);\n            if (serverSummary.suggested_next_steps !== undefined) serverNorm.suggested_next_steps = normalizeField(serverSummary.suggested_next_steps);\n            merged = {\n              ...merged,\n              ...serverNorm\n            };\n          }\n        } catch (e) {\n          // ignore server-side fetch errors and continue with local/processed summary\n        }\n        setFetchedSummary(merged);\n\n        // Dispatch suggestions to the ChatPanel so they become available as clickable inserts\n        try {\n          // helper: split concatenated Title-Case suggestions when punctuation is missing\n          const splitConcatenatedSuggestions = txt => {\n            if (!txt) return [];\n            const s = String(txt).replace(/\\s+/g, \" \").trim();\n            // if there are obvious separators, split on them\n            if (/[•\\-–—\\n,;|]/.test(s)) {\n              return s.split(/[\\n,;|•\\-–—]+/).map(t => t.trim()).filter(Boolean);\n            }\n            // Heuristic: split where a lowercase/number is followed by a capitalized word\n            const parts = s.replace(/([a-z0-9])\\s+(?=[A-Z])/g, '$1|||').split('|||').map(t => t.trim()).filter(Boolean);\n            if (parts.length > 1) return parts;\n            // Fallback: return the original as single-item array\n            return [s];\n          };\n          const rawSuggested = merged.suggested_next_steps || \"\";\n          let candidates = splitConcatenatedSuggestions(rawSuggested);\n          if (!candidates || candidates.length <= 1) {\n            // fallback to existing list extraction logic\n            candidates = extractListItems(rawSuggested);\n          }\n          // Stronger fallback: if we still have one long Title-Case string, try splitting on common action verbs\n          if (candidates.length === 1) {\n            const long = String(candidates[0] || \"\").trim();\n            const verbRegex = /\\b(Identify|Assess|Research|Define|Plan|Create|Organize|Explore|List|Set|Develop|Prioritize|Evaluate|Write|Map|Schedule|Clarify)\\b/gi;\n            const matches = [];\n            // Use exec loop to avoid needing downlevelIteration / matchAll compatibility\n            verbRegex.lastIndex = 0;\n            let mm;\n            while ((mm = verbRegex.exec(long)) !== null) {\n              var _mm$index;\n              matches.push({\n                idx: (_mm$index = mm.index) !== null && _mm$index !== void 0 ? _mm$index : 0,\n                word: mm[0]\n              });\n            }\n            if (matches.length > 1) {\n              const splits = [];\n              for (let i = 0; i < matches.length; i++) {\n                const start = matches[i].idx;\n                const end = i + 1 < matches.length ? matches[i + 1].idx : long.length;\n                const piece = long.slice(start, end).trim();\n                if (piece) splits.push(piece);\n              }\n              if (splits.length > 1) candidates = splits;\n            }\n          }\n          const suggestionItems = candidates.slice(0, 8).map(s => {\n            const cleaned = String(s).replace(/^\\*+/, \"\").replace(/\\*+$/, \"\").trim();\n            return cleaned.slice(0, 120);\n          }).filter(Boolean);\n          window.dispatchEvent(new CustomEvent(\"ai_suggestions\", {\n            detail: {\n              suggestions: suggestionItems\n            }\n          }));\n        } catch (e) {\n          // ignore dispatch errors\n        }\n      }\n    } catch (e) {\n      console.error(e);\n      setFetchedSummary({\n        current_state: \"Error contacting server\",\n        what_we_uncovered: \"\",\n        suggested_next_steps: \"\"\n      });\n    } finally {\n      setLoadingSummary(false);\n    }\n  }\n\n  // prevent accidental repeated Update Highlights calls by debouncing client-side\n  const lastFetchRef = useRef(0);\n  function debouncedFetchSummary(threadId) {\n    // keep a light guard here; the main debounce/guard lives inside fetchSummaryForThread\n    const now = Date.now();\n    if (lastFetchRef.current && now - lastFetchRef.current < 60000) {\n      window.dispatchEvent(new CustomEvent('ai_toast', {\n        detail: {\n          message: 'Please wait a moment before updating highlights again.',\n          kind: 'warn'\n        }\n      }));\n      return;\n    }\n    void fetchSummaryForThread(threadId);\n  }\n\n  // auto-load initial thread summary when selectedThreadId changes\n  useEffect(() => {\n    if (selectedThreadId) {\n      fetchSummaryForThread(selectedThreadId);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedThreadId]);\n\n  // helpers to start editing and save/cancel\n  function startEditSection(section) {\n    var _fetchedSummary$curre, _fetchedSummary$what_, _fetchedSummary$sugge;\n    setEditingSection(section);\n    if (section === \"current\") setDraftCurrent((_fetchedSummary$curre = fetchedSummary.current_state) !== null && _fetchedSummary$curre !== void 0 ? _fetchedSummary$curre : \"\");\n    if (section === \"uncovered\") setDraftUncovered((_fetchedSummary$what_ = fetchedSummary.what_we_uncovered) !== null && _fetchedSummary$what_ !== void 0 ? _fetchedSummary$what_ : \"\");\n    if (section === \"suggested\") setDraftSuggested((_fetchedSummary$sugge = fetchedSummary.suggested_next_steps) !== null && _fetchedSummary$sugge !== void 0 ? _fetchedSummary$sugge : \"\");\n  }\n  function cancelEditSection() {\n    setEditingSection(null);\n    setDraftCurrent(undefined);\n    setDraftUncovered(undefined);\n    setDraftSuggested(undefined);\n  }\n  function saveEditSection(section) {\n    const threadId = selectedThreadId;\n    const next = {\n      ...fetchedSummary\n    };\n    if (section === \"current\") next.current_state = draftCurrent !== null && draftCurrent !== void 0 ? draftCurrent : next.current_state;\n    if (section === \"uncovered\") next.what_we_uncovered = draftUncovered !== null && draftUncovered !== void 0 ? draftUncovered : next.what_we_uncovered;\n    if (section === \"suggested\") next.suggested_next_steps = draftSuggested !== null && draftSuggested !== void 0 ? draftSuggested : next.suggested_next_steps;\n    setFetchedSummary(next);\n    // persist per-thread edits\n    persistEditedSummary(threadId, {\n      current_state: next.current_state,\n      what_we_uncovered: next.what_we_uncovered,\n      suggested_next_steps: next.suggested_next_steps\n    });\n    // also POST edits to the backend so summaries persist across devices\n    try {\n      const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n      void fetch(`${API_BASE}/summary/save`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          user_id: USER_ID,\n          thread_id: threadId,\n          summary: {\n            current_state: next.current_state,\n            what_we_uncovered: next.what_we_uncovered,\n            suggested_next_steps: next.suggested_next_steps\n          }\n        })\n      });\n    } catch (e) {\n      // ignore network errors; client still has local copy\n    }\n    setEditingSection(null);\n  }\n\n  // Add the content of a summary tile as a new journal entry\n  function addTileToJournal(section) {\n    var _fetchedSummary$curre2, _fetchedSummary$what_2, _fetchedSummary$sugge2;\n    const titleMap = {\n      current: \"Current state\",\n      uncovered: \"What we’ve uncovered\",\n      suggested: \"Suggested next steps\"\n    };\n    let body = \"\";\n    if (section === \"current\") body = editingSection === \"current\" ? draftCurrent !== null && draftCurrent !== void 0 ? draftCurrent : \"\" : (_fetchedSummary$curre2 = fetchedSummary.current_state) !== null && _fetchedSummary$curre2 !== void 0 ? _fetchedSummary$curre2 : \"\";\n    if (section === \"uncovered\") body = editingSection === \"uncovered\" ? draftUncovered !== null && draftUncovered !== void 0 ? draftUncovered : \"\" : (_fetchedSummary$what_2 = fetchedSummary.what_we_uncovered) !== null && _fetchedSummary$what_2 !== void 0 ? _fetchedSummary$what_2 : \"\";\n    if (section === \"suggested\") body = editingSection === \"suggested\" ? draftSuggested !== null && draftSuggested !== void 0 ? draftSuggested : \"\" : (_fetchedSummary$sugge2 = fetchedSummary.suggested_next_steps) !== null && _fetchedSummary$sugge2 !== void 0 ? _fetchedSummary$sugge2 : \"\";\n    const text = (body || \"\").toString().trim();\n    if (!text) {\n      window.dispatchEvent(new CustomEvent('ai_toast', {\n        detail: {\n          message: 'Nothing to add to journal.',\n          kind: 'warn'\n        }\n      }));\n      return;\n    }\n    const entry = {\n      entry_id: `j${Date.now()}`,\n      linked_session_id: \"\",\n      title: titleMap[section] || \"Summary\",\n      content: text,\n      created_at: new Date().toISOString(),\n      source: \"ai_suggested\"\n    };\n    const next = [entry, ...entries];\n    persistEntries(next);\n    // show toast with Undo action wired to a global undo event\n    window.dispatchEvent(new CustomEvent('ai_toast', {\n      detail: {\n        message: `Added \\\"${entry.title}\\\" to your journal.`,\n        kind: 'success',\n        actionLabel: 'Undo',\n        actionEvent: 'undo_journal_add',\n        actionPayload: {\n          entry_id: entry.entry_id\n        }\n      }\n    }));\n\n    // also set a local recentlyAdded state so the + button becomes an inline Undo for a short window\n    try {\n      setRecentlyAdded({\n        entry_id: entry.entry_id,\n        section\n      });\n      if (undoTimerRef.current) window.clearTimeout(undoTimerRef.current);\n      undoTimerRef.current = window.setTimeout(() => {\n        setRecentlyAdded(null);\n        undoTimerRef.current = null;\n      }, 6000);\n    } catch (e) {\n      // ignore timer errors in some environments\n    }\n  }\n\n  // local undo handler (used when user clicks inline Undo button)\n  function undoRecentAdd(entryId) {\n    const id = entryId || (recentlyAdded === null || recentlyAdded === void 0 ? void 0 : recentlyAdded.entry_id);\n    if (!id) return;\n    setEntries(prev => {\n      const next = prev.filter(p => p.entry_id !== id);\n      try {\n        localStorage.setItem('ai_journal_entries', JSON.stringify(next));\n      } catch (err) {}\n      return next;\n    });\n    setRecentlyAdded(null);\n    if (undoTimerRef.current) {\n      window.clearTimeout(undoTimerRef.current);\n      undoTimerRef.current = null;\n    }\n    window.dispatchEvent(new CustomEvent('ai_toast', {\n      detail: {\n        message: 'Removed entry.',\n        kind: 'info'\n      }\n    }));\n  }\n\n  // Listen for undo events from the toast manager and remove the corresponding entry\n  useEffect(() => {\n    function handleUndo(e) {\n      var _e$detail;\n      const id = (_e$detail = e.detail) === null || _e$detail === void 0 ? void 0 : _e$detail.entry_id;\n      if (!id) return;\n      setEntries(prev => {\n        const next = prev.filter(p => p.entry_id !== id);\n        try {\n          localStorage.setItem('ai_journal_entries', JSON.stringify(next));\n        } catch (err) {}\n        return next;\n      });\n      // inform user\n      window.dispatchEvent(new CustomEvent('ai_toast', {\n        detail: {\n          message: 'Removed entry.',\n          kind: 'info'\n        }\n      }));\n    }\n    window.addEventListener('undo_journal_add', handleUndo);\n    return () => window.removeEventListener('undo_journal_add', handleUndo);\n  }, []);\n\n  // helper to render returned summary text as paragraphs or lists\n  const renderRichText = txt => {\n    if (!txt) return /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"muted\",\n      children: \"\\u2014\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 606,\n      columnNumber: 22\n    }, this);\n    // normalize line endings\n    const normalized = String(txt).replace(/\\r\\n/g, \"\\n\").trim();\n    if (!normalized) return /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"muted\",\n      children: \"\\u2014\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 29\n    }, this);\n    const lines = normalized.split(/\\n+/).map(s => s.trim()).filter(Boolean);\n\n    // detect bullet list (lines starting with '- ')\n    const isDashList = lines.every(l => /^[-•*]\\s+/.test(l));\n    if (isDashList) {\n      return /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: lines.map((l, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n          children: l.replace(/^[-•*]\\s+/, \"\")\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 616,\n          columnNumber: 39\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 616,\n        columnNumber: 14\n      }, this);\n    }\n\n    // detect numbered list (lines starting with '1.' etc)\n    const isNumbered = lines.every(l => /^\\d+\\./.test(l));\n    if (isNumbered) {\n      return /*#__PURE__*/_jsxDEV(\"ol\", {\n        children: lines.map((l, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n          children: l.replace(/^\\d+\\.\\s*/, \"\")\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 622,\n          columnNumber: 39\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 14\n      }, this);\n    }\n\n    // otherwise render paragraphs for double-newline separated blocks\n    if (lines.length > 1) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: lines.map((p, i) => /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            marginTop: i === 0 ? 0 : 8\n          },\n          children: p\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 627,\n          columnNumber: 40\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 627,\n        columnNumber: 14\n      }, this);\n    }\n\n    // single-line text\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: normalized\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 631,\n      columnNumber: 12\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"aside\", {\n    className: \"right-panel\",\n    style: {\n      maxHeight: \"calc(100vh - 48px)\",\n      overflow: \"auto\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"right-panel__section\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"info-tile current-state\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"current-state-head\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"highlights-btn\",\n                onClick: () => debouncedFetchSummary(selectedThreadId),\n                disabled: loadingSummary,\n                \"aria-label\": \"Update Highlights\",\n                children: loadingSummary ? /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"ai-spinner\",\n                  \"aria-hidden\": true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 647,\n                  columnNumber: 37\n                }, this) : \"Update Highlights\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 641,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 640,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 639,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"state-controls\",\n            style: {\n              display: \"flex\",\n              gap: 8,\n              alignItems: \"center\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"state-ornament\",\n              \"aria-hidden\": true,\n              children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                width: \"54\",\n                height: \"54\",\n                viewBox: \"0 0 24 24\",\n                fill: \"none\",\n                xmlns: \"http://www.w3.org/2000/svg\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M12 2v6l4 2\",\n                  stroke: \"rgba(123,97,255,0.18)\",\n                  strokeWidth: \"1.4\",\n                  strokeLinecap: \"round\",\n                  strokeLinejoin: \"round\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 657,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n                  cx: \"12\",\n                  cy: \"12\",\n                  r: \"9\",\n                  stroke: \"rgba(123,97,255,0.06)\",\n                  strokeWidth: \"1.2\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 658,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 656,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 654,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                gap: 8,\n                alignItems: \"center\"\n              },\n              children: threads.length > 0 ? /*#__PURE__*/_jsxDEV(\"select\", {\n                value: selectedThreadId,\n                onChange: e => setSelectedThreadId(e.target.value),\n                className: \"thread-selector\",\n                children: threads.map(t => /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: t.thread_id,\n                  children: t.title\n                }, t.thread_id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 670,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 664,\n                columnNumber: 19\n              }, this) : null\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 662,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 653,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 638,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"info-body\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-section uncovered uncovered-what\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontWeight: 600\n                },\n                children: \"Current state\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 685,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  gap: 8,\n                  alignItems: 'center'\n                },\n                children: editingSection === 'current' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => saveEditSection('current'),\n                    children: \"Save\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 689,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: cancelEditSection,\n                    children: \"Cancel\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 690,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => startEditSection('current'),\n                    \"aria-label\": \"Edit\",\n                    children: \"\\u270F\\uFE0F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 694,\n                    columnNumber: 23\n                  }, this), (recentlyAdded === null || recentlyAdded === void 0 ? void 0 : recentlyAdded.section) === 'current' && recentlyAdded.entry_id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn undo-btn\",\n                    onClick: () => undoRecentAdd(recentlyAdded.entry_id),\n                    children: \"Undo\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 696,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn add-btn\",\n                    onClick: () => addTileToJournal('current'),\n                    \"aria-label\": \"Add to journal\",\n                    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                      width: \"14\",\n                      height: \"14\",\n                      viewBox: \"0 0 24 24\",\n                      fill: \"none\",\n                      xmlns: \"http://www.w3.org/2000/svg\",\n                      \"aria-hidden\": true,\n                      children: /*#__PURE__*/_jsxDEV(\"path\", {\n                        d: \"M12 5v14M5 12h14\",\n                        stroke: \"currentColor\",\n                        strokeWidth: \"2\",\n                        strokeLinecap: \"round\",\n                        strokeLinejoin: \"round\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 700,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 699,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 698,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 686,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 684,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"summary-text\",\n              style: {\n                fontSize: 16,\n                lineHeight: 1.5,\n                marginTop: 8\n              },\n              children: editingSection === 'current' ? /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: draftCurrent !== null && draftCurrent !== void 0 ? draftCurrent : '',\n                onChange: e => setDraftCurrent(e.target.value),\n                style: {\n                  width: '100%',\n                  minHeight: 120\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 710,\n                columnNumber: 19\n              }, this) : renderRichText((_ref = (_ref2 = (_fetchedSummary$curre3 = fetchedSummary.current_state) !== null && _fetchedSummary$curre3 !== void 0 ? _fetchedSummary$curre3 : propSummary === null || propSummary === void 0 ? void 0 : propSummary.current_state) !== null && _ref2 !== void 0 ? _ref2 : propSummary === null || propSummary === void 0 ? void 0 : propSummary.summary_text) !== null && _ref !== void 0 ? _ref : \"No summary yet. Click 'Update Highlights'.\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 708,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 683,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-section uncovered\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                style: {\n                  margin: 0\n                },\n                children: \"What we\\u2019ve uncovered\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 720,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  gap: 8,\n                  alignItems: 'center'\n                },\n                children: editingSection === 'uncovered' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => saveEditSection('uncovered'),\n                    children: \"Save\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 724,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: cancelEditSection,\n                    children: \"Cancel\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 725,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => startEditSection('uncovered'),\n                    \"aria-label\": \"Edit\",\n                    children: \"\\u270F\\uFE0F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 729,\n                    columnNumber: 23\n                  }, this), (recentlyAdded === null || recentlyAdded === void 0 ? void 0 : recentlyAdded.section) === 'uncovered' && recentlyAdded.entry_id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn undo-btn\",\n                    onClick: () => undoRecentAdd(recentlyAdded.entry_id),\n                    children: \"Undo\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 731,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn add-btn\",\n                    onClick: () => addTileToJournal('uncovered'),\n                    \"aria-label\": \"Add to journal\",\n                    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                      width: \"14\",\n                      height: \"14\",\n                      viewBox: \"0 0 24 24\",\n                      fill: \"none\",\n                      xmlns: \"http://www.w3.org/2000/svg\",\n                      \"aria-hidden\": true,\n                      children: /*#__PURE__*/_jsxDEV(\"path\", {\n                        d: \"M12 5v14M5 12h14\",\n                        stroke: \"currentColor\",\n                        strokeWidth: \"2\",\n                        strokeLinecap: \"round\",\n                        strokeLinejoin: \"round\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 735,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 734,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 733,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 721,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 719,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"summary-text\",\n              style: {\n                fontSize: 16,\n                lineHeight: 1.5,\n                marginTop: 8\n              },\n              children: editingSection === 'uncovered' ? /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: draftUncovered !== null && draftUncovered !== void 0 ? draftUncovered : '',\n                onChange: e => setDraftUncovered(e.target.value),\n                style: {\n                  width: '100%',\n                  minHeight: 120\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 745,\n                columnNumber: 19\n              }, this) : renderRichText((_fetchedSummary$what_3 = fetchedSummary.what_we_uncovered) !== null && _fetchedSummary$what_3 !== void 0 ? _fetchedSummary$what_3 : propSummary && (_propSummary$key_poin = propSummary.key_points) !== null && _propSummary$key_poin !== void 0 && _propSummary$key_poin.length ? propSummary.key_points.join(\"\\n\") : \"—\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 743,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 718,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"info-section suggestions\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                style: {\n                  margin: 0\n                },\n                children: \"Suggested next steps\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 754,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  gap: 8,\n                  alignItems: 'center'\n                },\n                children: editingSection === 'suggested' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => saveEditSection('suggested'),\n                    children: \"Save\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 758,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: cancelEditSection,\n                    children: \"Cancel\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 759,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn\",\n                    onClick: () => startEditSection('suggested'),\n                    \"aria-label\": \"Edit\",\n                    children: \"\\u270F\\uFE0F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 763,\n                    columnNumber: 23\n                  }, this), (recentlyAdded === null || recentlyAdded === void 0 ? void 0 : recentlyAdded.section) === 'suggested' && recentlyAdded.entry_id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn undo-btn\",\n                    onClick: () => undoRecentAdd(recentlyAdded.entry_id),\n                    children: \"Undo\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 765,\n                    columnNumber: 25\n                  }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"prompt-btn add-btn\",\n                    onClick: () => addTileToJournal('suggested'),\n                    \"aria-label\": \"Add to journal\",\n                    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                      width: \"14\",\n                      height: \"14\",\n                      viewBox: \"0 0 24 24\",\n                      fill: \"none\",\n                      xmlns: \"http://www.w3.org/2000/svg\",\n                      \"aria-hidden\": true,\n                      children: /*#__PURE__*/_jsxDEV(\"path\", {\n                        d: \"M12 5v14M5 12h14\",\n                        stroke: \"currentColor\",\n                        strokeWidth: \"2\",\n                        strokeLinecap: \"round\",\n                        strokeLinejoin: \"round\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 769,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 768,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 767,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 755,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 753,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"summary-text\",\n              style: {\n                fontSize: 16,\n                lineHeight: 1.5,\n                marginTop: 8\n              },\n              children: editingSection === 'suggested' ? /*#__PURE__*/_jsxDEV(\"textarea\", {\n                value: draftSuggested !== null && draftSuggested !== void 0 ? draftSuggested : '',\n                onChange: e => setDraftSuggested(e.target.value),\n                style: {\n                  width: '100%',\n                  minHeight: 120\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 779,\n                columnNumber: 19\n              }, this) : renderRichText((_fetchedSummary$sugge3 = fetchedSummary.suggested_next_steps) !== null && _fetchedSummary$sugge3 !== void 0 ? _fetchedSummary$sugge3 : \"—\")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 777,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 752,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 680,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 637,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 636,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"right-panel__section\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"journal-tile\",\n        role: \"button\",\n        onClick: () => setOpenFull(true),\n        \"aria-pressed\": openFull,\n        tabIndex: 0,\n        onKeyDown: e => {\n          if (e.key === \"Enter\" || e.key === \" \") setOpenFull(true);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"journal-icon big\",\n          \"aria-hidden\": true,\n          children: \"\\uD83D\\uDCD4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 803,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"journal-label\",\n          children: \"Your Journal\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 806,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 793,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 792,\n      columnNumber: 7\n    }, this), openFull && typeof document !== \"undefined\" && document.body ? /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-backdrop\",\n      role: \"dialog\",\n      \"aria-modal\": \"true\",\n      onClick: () => setOpenFull(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `modal full-journal`,\n        style: {\n          width: `${modalWidth}vw`\n        },\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Your Journal\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 819,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              gap: 12,\n              alignItems: \"center\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"muted\",\n              style: {\n                fontSize: \"0.85rem\"\n              },\n              children: \"Width\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 821,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              min: 60,\n              max: 95,\n              value: modalWidth,\n              onChange: e => setModalWidth(Number(e.target.value))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 822,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"muted\",\n              style: {\n                fontSize: \"0.85rem\"\n              },\n              children: \"Font\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 829,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"font-picker\",\n              value: fontChoice,\n              onChange: e => setFontChoice(e.target.value),\n              \"aria-label\": \"Journal font picker\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Patrick Hand\",\n                children: \"Patrick Hand\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 831,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Indie Flower\",\n                children: \"Indie Flower\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 832,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"Caveat\",\n                children: \"Caveat\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 833,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 830,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"prompt-btn\",\n              onClick: () => setOpenFull(false),\n              children: \"Close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 835,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 820,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 818,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-body\",\n          style: {\n            alignItems: \"stretch\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"journal-list\",\n            style: {\n              width: \"300px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"journal-list-header muted\",\n              children: \"Entries\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 841,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              children: entries.map(e => /*#__PURE__*/_jsxDEV(\"li\", {\n                className: `journal-list-item ${(selectedEntry === null || selectedEntry === void 0 ? void 0 : selectedEntry.entry_id) === e.entry_id ? \"active\" : \"\"}`,\n                onClick: () => setSelectedEntry(e),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"jl-title\",\n                  children: e.title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 845,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"jl-date muted\",\n                  children: new Date(e.created_at).toLocaleDateString()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 846,\n                  columnNumber: 27\n                }, this)]\n              }, e.entry_id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 844,\n                columnNumber: 25\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 842,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 840,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"journal-right\",\n            style: {\n              flex: 1\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"journal-new-row\",\n              style: {\n                display: \"flex\",\n                flexDirection: \"column\",\n                gap: 8\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: \"flex\",\n                  justifyContent: \"space-between\",\n                  alignItems: \"center\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                  style: {\n                    margin: 0\n                  },\n                  children: \"New Entry\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 855,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"prompt-btn\",\n                  onClick: () => {\n                    setShowNewForm(s => !s);\n                    setNewTitle(\"\");\n                    setNewContent(\"\");\n                  },\n                  children: showNewForm ? \"Cancel\" : \"New\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 856,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 854,\n                columnNumber: 23\n              }, this), showNewForm && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: \"flex\",\n                  gap: 12\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    width: 160\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    className: \"journal-input title-input\",\n                    placeholder: \"Title\",\n                    value: newTitle,\n                    onChange: e => setNewTitle(e.target.value)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 864,\n                    columnNumber: 29\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 863,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    flex: 1\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                    className: \"journal-textarea\",\n                    placeholder: \"Write your entry...\",\n                    value: newContent,\n                    onChange: e => setNewContent(e.target.value),\n                    style: {\n                      fontFamily: fontChoice\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 867,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      display: \"flex\",\n                      gap: 8,\n                      marginTop: 8\n                    },\n                    children: /*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"prompt-btn\",\n                      onClick: () => {\n                        const t = newTitle;\n                        const c = newContent;\n                        if (!t.trim() && !c.trim()) return;\n                        const entry = {\n                          entry_id: `j${Date.now()}`,\n                          linked_session_id: \"\",\n                          title: t.trim() || \"Untitled\",\n                          content: c.trim(),\n                          created_at: new Date().toISOString(),\n                          source: \"user_written\"\n                        };\n                        const next = [entry, ...entries];\n                        persistEntries(next);\n                        setSelectedEntry(entry);\n                        setShowNewForm(false);\n                        setNewTitle(\"\");\n                        setNewContent(\"\");\n                      },\n                      children: \"Save Entry\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 869,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 868,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 866,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 862,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 853,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"journal-preview\",\n              style: {\n                marginTop: 12\n              },\n              children: selectedEntry ? editingEntryId === selectedEntry.entry_id ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"notebook-card\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"note-head\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      display: \"flex\",\n                      gap: 12,\n                      alignItems: \"center\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                      className: \"journal-input title-input\",\n                      value: editTitle,\n                      onChange: e => setEditTitle(e.target.value)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 893,\n                      columnNumber: 33\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        marginLeft: \"auto\",\n                        display: \"flex\",\n                        gap: 8\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"prompt-btn\",\n                        onClick: () => saveEdit(selectedEntry.entry_id),\n                        children: \"Save\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 895,\n                        columnNumber: 35\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"prompt-btn\",\n                        onClick: cancelEdit,\n                        children: \"Cancel\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 896,\n                        columnNumber: 35\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 894,\n                      columnNumber: 33\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 892,\n                    columnNumber: 31\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"muted\",\n                    children: new Date(selectedEntry.created_at).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 899,\n                    columnNumber: 31\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 891,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"note-body\",\n                  children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n                    className: \"journal-textarea\",\n                    value: editContent,\n                    onChange: e => setEditContent(e.target.value),\n                    style: {\n                      fontFamily: fontChoice\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 902,\n                    columnNumber: 31\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 901,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 890,\n                columnNumber: 27\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"notebook-card\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"note-head\",\n                  style: {\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    gap: 12\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: selectedEntry.title\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 908,\n                    columnNumber: 31\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"muted\",\n                    children: new Date(selectedEntry.created_at).toLocaleString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 909,\n                    columnNumber: 31\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      marginLeft: \"auto\",\n                      display: \"flex\",\n                      gap: 8\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"prompt-btn\",\n                      onClick: () => startEdit(selectedEntry),\n                      children: \"Edit\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 911,\n                      columnNumber: 33\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"prompt-btn\",\n                      onClick: () => deleteEntry(selectedEntry.entry_id),\n                      children: \"Delete\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 912,\n                      columnNumber: 33\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 910,\n                    columnNumber: 31\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 907,\n                  columnNumber: 29\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"note-body\",\n                  children: selectedEntry.content.split(\"\\n\").map((ln, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"note-line\",\n                    style: {\n                      fontFamily: fontChoice\n                    },\n                    children: ln\n                  }, i, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 917,\n                    columnNumber: 33\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 915,\n                  columnNumber: 29\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 906,\n                columnNumber: 27\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"muted\",\n                children: \"Select an entry from the left to view it here.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 923,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 887,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 852,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 839,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 813,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 812,\n      columnNumber: 13\n    }, this), document.body) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 635,\n    columnNumber: 5\n  }, this);\n}\n\n// Small form component for creating a journal entry (kept local)\n_s(RightPanel, \"Ug0R1fKTSBW6ZC2oODHMLKyTgTk=\");\n_c = RightPanel;\nfunction JournalForm({\n  onSave\n}) {\n  _s2();\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  function handleSave() {\n    if (!title.trim() && !content.trim()) return;\n    const entry = {\n      entry_id: `j${Date.now()}`,\n      linked_session_id: \"\",\n      title: title.trim() || \"Untitled\",\n      content: content.trim(),\n      created_at: new Date().toISOString(),\n      source: \"user_written\"\n    };\n    onSave(entry);\n    setTitle(\"\");\n    setContent(\"\");\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      className: \"journal-input\",\n      placeholder: \"Title\",\n      value: title,\n      onChange: e => setTitle(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 959,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      className: \"journal-textarea\",\n      placeholder: \"Write your entry...\",\n      value: content,\n      onChange: e => setContent(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 960,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        gap: 8\n      },\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"prompt-btn\",\n        onClick: handleSave,\n        children: \"Save Entry\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 962,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 961,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 958,\n    columnNumber: 5\n  }, this);\n}\n_s2(JournalForm, \"eiXkh+GEjRZ8Svxty8bnXm2rLL0=\");\n_c2 = JournalForm;\nvar _c, _c2;\n$RefreshReg$(_c, \"RightPanel\");\n$RefreshReg$(_c2, \"JournalForm\");","map":{"version":3,"names":["useState","useEffect","useRef","createPortal","journalEntries","seededJournal","jsxDEV","_jsxDEV","Fragment","_Fragment","MODE_HINTS","exploring_options","label","description","suggestions","overwhelmed","reflective","decisive","RightPanel","mode","summary","propSummary","threads","_s","_threads$0$thread_id","_threads$","_entries$","_ref","_ref2","_fetchedSummary$curre3","_fetchedSummary$what_3","_propSummary$key_poin","_fetchedSummary$sugge3","modeConfig","API_BASE","window","process","env","REACT_APP_API_BASE","openFull","setOpenFull","entries","setEntries","selectedEntry","setSelectedEntry","modalWidth","setModalWidth","showNewForm","setShowNewForm","newTitle","setNewTitle","newContent","setNewContent","fontChoice","setFontChoice","editingEntryId","setEditingEntryId","editTitle","setEditTitle","editContent","setEditContent","selectedThreadId","setSelectedThreadId","thread_id","loadingSummary","setLoadingSummary","fetchedSummary","setFetchedSummary","editingSection","setEditingSection","draftCurrent","setDraftCurrent","undefined","draftUncovered","setDraftUncovered","draftSuggested","setDraftSuggested","recentlyAdded","setRecentlyAdded","undoTimerRef","EDIT_KEY_PREFIX","loadEditedSummary","threadId","key","raw","localStorage","getItem","parsed","JSON","parse","e","persistEditedSummary","data","setItem","stringify","persistEntries","next","startEdit","entry","entry_id","title","content","saveEdit","entryId","_next$find","map","en","updated","find","n","cancelEdit","deleteEntry","confirm","filter","_next$","latestEntry","w","Number","f","String","length","s","limitSentences","text","maxSentences","maxWords","cleaned","replace","trim","sentences","split","taken","slice","join","words","Boolean","extractListItems","normalized","lines","l","bullets","test","parts","p","processCurrentState","processWhatWeUncovered","items","take","it","processSuggestedNextSteps","short","t","fetchSummaryForThread","now","Date","lastFetchRef","current","dispatchEvent","CustomEvent","detail","message","kind","USER_ID","msgsRes","fetch","encodeURIComponent","ok","Error","msgsJson","json","conversation","messages","m","role","serverSavedSummary","savedRes","sv","summaryRes","method","headers","Accept","body","last_summary","errBody","console","error","status","current_state","what_we_uncovered","suggested_next_steps","_parsed$summary","_parsed$summary2","_parsed$summary3","base","normalizeField","v","Array","isArray","normBase","processedBase","edited","merged","serverSummary","serverNorm","splitConcatenatedSuggestions","txt","rawSuggested","candidates","long","verbRegex","matches","lastIndex","mm","exec","_mm$index","push","idx","index","word","splits","i","start","end","piece","suggestionItems","debouncedFetchSummary","startEditSection","section","_fetchedSummary$curre","_fetchedSummary$what_","_fetchedSummary$sugge","cancelEditSection","saveEditSection","user_id","addTileToJournal","_fetchedSummary$curre2","_fetchedSummary$what_2","_fetchedSummary$sugge2","titleMap","uncovered","suggested","toString","linked_session_id","created_at","toISOString","source","actionLabel","actionEvent","actionPayload","clearTimeout","setTimeout","undoRecentAdd","id","prev","err","handleUndo","_e$detail","addEventListener","removeEventListener","renderRichText","className","children","fileName","_jsxFileName","lineNumber","columnNumber","isDashList","every","isNumbered","style","marginTop","maxHeight","overflow","onClick","disabled","display","gap","alignItems","width","height","viewBox","fill","xmlns","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","cx","cy","r","value","onChange","target","justifyContent","fontWeight","fontSize","lineHeight","minHeight","summary_text","margin","key_points","tabIndex","onKeyDown","document","stopPropagation","type","min","max","toLocaleDateString","flex","flexDirection","placeholder","fontFamily","c","marginLeft","toLocaleString","ln","_c","JournalForm","onSave","_s2","setTitle","setContent","handleSave","_c2","$RefreshReg$"],"sources":["/Users/ankurporwal/Documents/AIConsultation/Frontend/src/components/layout/RightPanel.tsx"],"sourcesContent":["import { DetectedMode, SessionSummary, JournalEntry } from \"../../types/thinking\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { journalEntries as seededJournal } from \"../../data/journal\";\nimport \"./RightPanel.css\";\n\ninterface ThreadRef {\n  thread_id: string;\n  title: string;\n}\n\ninterface RightPanelProps {\n  mode?: DetectedMode;\n  summary?: SessionSummary | null;\n  threads?: ThreadRef[];\n}\n\nconst MODE_HINTS: Record<\n  DetectedMode,\n  {\n    label: string;\n    description: string;\n    suggestions: string[];\n  }\n> = {\n  exploring_options: {\n    label: \"Exploration\",\n    description: \"Exploring options and clarifying ideas.\",\n    suggestions: [\n      \"Ask why this problem matters\",\n      \"Challenge your assumptions\",\n      \"Explore alternative angles\",\n    ],\n  },\n  overwhelmed: {\n    label: \"Overwhelmed\",\n    description: \"You're feeling overloaded or uncertain about where to start.\",\n    suggestions: [\n      \"Identify the smallest next step\",\n      \"Prioritize ruthlessly\",\n      \"Take a short break and return with fresh eyes\",\n    ],\n  },\n  reflective: {\n    label: \"Reflection\",\n    description: \"You're processing past actions or thoughts.\",\n    suggestions: [\n      \"What worked well?\",\n      \"What would you change?\",\n      \"What pattern do you notice?\",\n    ],\n  },\n  decisive: {\n    label: \"Decision Making\",\n    description: \"You're evaluating options and moving toward a choice.\",\n    suggestions: [\n      \"List pros and cons\",\n      \"Define success criteria\",\n      \"Identify irreversible decisions\",\n    ],\n  },\n};\n\nexport default function RightPanel({\n  mode,\n  summary: propSummary = null,\n  threads = [],\n}: RightPanelProps) {\n  const modeConfig = mode ? MODE_HINTS[mode] : null;\n\n  // API base: allow overriding via `REACT_APP_API_BASE` or window.API_BASE\n  const API_BASE = (typeof window !== \"undefined\" && (window as any).API_BASE) || (process.env.REACT_APP_API_BASE as string) || \"http://localhost:8000\";\n\n  const [openFull, setOpenFull] = useState(false);\n  const [entries, setEntries] = useState<JournalEntry[]>([]);\n  const [selectedEntry, setSelectedEntry] = useState<JournalEntry | null>(null);\n  const [modalWidth, setModalWidth] = useState<number>(75); // vw\n  const [showNewForm, setShowNewForm] = useState<boolean>(false);\n  const [newTitle, setNewTitle] = useState(\"\");\n  const [newContent, setNewContent] = useState(\"\");\n  const [fontChoice, setFontChoice] = useState<string>(\"Patrick Hand\");\n\n  // editing state\n  const [editingEntryId, setEditingEntryId] = useState<string | null>(null);\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [editContent, setEditContent] = useState(\"\");\n\n  // summary / threads\n  const [selectedThreadId, setSelectedThreadId] = useState<string>(\n    threads?.[0]?.thread_id ?? \"t1\"\n  );\n  const [loadingSummary, setLoadingSummary] = useState(false);\n  const [fetchedSummary, setFetchedSummary] = useState<{\n    current_state?: string;\n    what_we_uncovered?: string;\n    suggested_next_steps?: string;\n  }>({});\n  const [editingSection, setEditingSection] = useState<null | \"current\" | \"uncovered\" | \"suggested\">(null);\n  const [draftCurrent, setDraftCurrent] = useState<string | undefined>(undefined);\n  const [draftUncovered, setDraftUncovered] = useState<string | undefined>(undefined);\n  const [draftSuggested, setDraftSuggested] = useState<string | undefined>(undefined);\n  const [recentlyAdded, setRecentlyAdded] = useState<{ entry_id: string; section: \"current\" | \"uncovered\" | \"suggested\" } | null>(null);\n  const undoTimerRef = useRef<number | null>(null);\n\n  const EDIT_KEY_PREFIX = \"ai_edited_summary_\";\n\n  function loadEditedSummary(threadId: string) {\n    try {\n      const key = `${EDIT_KEY_PREFIX}${threadId}`;\n      const raw = localStorage.getItem(key);\n      if (!raw) return null;\n      const parsed = JSON.parse(raw);\n      return parsed;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  function persistEditedSummary(threadId: string, data: any) {\n    try {\n      const key = `${EDIT_KEY_PREFIX}${threadId}`;\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch (e) {\n      // ignore\n    }\n  }\n\n  // load entries from localStorage or seeded\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(\"ai_journal_entries\");\n      if (raw) {\n        setEntries(JSON.parse(raw));\n      } else {\n        setEntries(seededJournal);\n      }\n    } catch (e) {\n      setEntries(seededJournal);\n    }\n  }, []);\n\n  // persist helper\n  function persistEntries(next: JournalEntry[]) {\n    setEntries(next);\n    try {\n      localStorage.setItem(\"ai_journal_entries\", JSON.stringify(next));\n    } catch (e) {\n      /* ignore */\n    }\n  }\n\n  function startEdit(entry: JournalEntry) {\n    setSelectedEntry(entry);\n    setEditingEntryId(entry.entry_id);\n    setEditTitle(entry.title);\n    setEditContent(entry.content);\n  }\n\n  function saveEdit(entryId: string) {\n    const next = entries.map((en) =>\n      en.entry_id === entryId ? { ...en, title: editTitle, content: editContent } : en\n    );\n    persistEntries(next);\n    setEditingEntryId(null);\n    const updated = next.find((n) => n.entry_id === entryId) ?? null;\n    setSelectedEntry(updated);\n  }\n\n  function cancelEdit() {\n    setEditingEntryId(null);\n    setEditTitle(\"\");\n    setEditContent(\"\");\n  }\n\n  function deleteEntry(entryId: string) {\n    if (!window.confirm(\"Delete this journal entry?\")) return;\n    const next = entries.filter((e) => e.entry_id !== entryId);\n    persistEntries(next);\n    if (selectedEntry?.entry_id === entryId) {\n      setSelectedEntry(next[0] ?? null);\n    }\n  }\n\n  const latestEntry = entries[0] ?? null;\n\n  // modal width + font choice persistence\n  useEffect(() => {\n    try {\n      const w = localStorage.getItem(\"ai_journal_modal_width\");\n      if (w) setModalWidth(Number(w));\n    } catch (e) {}\n  }, []);\n\n  useEffect(() => {\n    try {\n      const f = localStorage.getItem(\"ai_journal_font\");\n      if (f) setFontChoice(f);\n    } catch (e) {}\n  }, []);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(\"ai_journal_modal_width\", String(modalWidth));\n    } catch (e) {}\n  }, [modalWidth]);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(\"ai_journal_font\", fontChoice);\n    } catch (e) {}\n  }, [fontChoice]);\n\n  // keep selectedThreadId in sync if threads prop changes\n  useEffect(() => {\n    if (threads && threads.length > 0) {\n      setSelectedThreadId((s) => s || threads[0].thread_id);\n    }\n  }, [threads]);\n\n  // --- Summary post-processing helpers (client-side truncation/formatting) ---\n  const limitSentences = (text: string | undefined | null, maxSentences = 3, maxWords = 40) => {\n    if (!text) return \"\";\n    const cleaned = String(text).replace(/\\s+/g, \" \").trim();\n    if (!cleaned) return \"\";\n    // split on end-of-sentence punctuation followed by space\n    const sentences = cleaned.split(/(?<=[.!?])\\s+/);\n    const taken = sentences.slice(0, maxSentences).join(' ');\n    const words = taken.split(/\\s+/).filter(Boolean);\n    if (words.length > maxWords) return words.slice(0, maxWords).join(' ') + '…';\n    return taken;\n  };\n\n  const extractListItems = (text: string | undefined | null) => {\n    if (!text) return [] as string[];\n    const normalized = String(text).replace(/\\r\\n/g, '\\n').trim();\n    if (!normalized) return [];\n    const lines = normalized.split(/\\n+/).map((l) => l.trim()).filter(Boolean);\n    // detect explicit bullets or numbered lines\n    const bullets = lines.filter((l) => /^[-•*]\\s+/.test(l) || /^\\d+[\\.\\)]\\s+/.test(l));\n    if (bullets.length) {\n      return bullets.map((l) => l.replace(/^[-•*\\d\\.\\)\\s]+/, '').trim());\n    }\n    // fallback: split into sentences\n    const sentences = normalized.split(/(?<=[.!?])\\s+/).map(s => s.trim()).filter(Boolean);\n    if (sentences.length > 1) return sentences;\n    // fallback: split by semicolons or pipes\n    const parts = normalized.split(/[;|\\u2022]/).map(p => p.trim()).filter(Boolean);\n    return parts.length ? parts : [normalized];\n  };\n\n  const processCurrentState = (text: string | undefined | null) => {\n    // 2-3 short sentences, roughly capped to ~40 words\n    return limitSentences(text, 3, 40);\n  };\n\n  const processWhatWeUncovered = (text: string | undefined | null) => {\n    const items = extractListItems(text);\n    const take = items.slice(0, 3);\n    if (take.length === 0) return '';\n    // return as dash-list so renderRichText shows bullets\n    return take.map((it) => `- ${it}`).join('\\n');\n  };\n\n  const processSuggestedNextSteps = (text: string | undefined | null) => {\n    const items = extractListItems(text);\n    const take = items.slice(0, 4).map((it) => {\n      // keep only the short title before ':' or ' - '\n      const short = it.split(/[:\\-|–—]/)[0].trim();\n      // cap title length to reasonable words\n      const words = short.split(/\\s+/).slice(0, 12).join(' ');\n      return words;\n    });\n    if (take.length === 0) return '';\n    return take.map((t) => `- ${t}`).join('\\n');\n  };\n\n  async function fetchSummaryForThread(threadId: string) {\n    // debounce guard: prevent repeat calls within short window (60s)\n    const now = Date.now();\n    if (lastFetchRef.current && now - lastFetchRef.current < 60000) {\n      window.dispatchEvent(new CustomEvent('ai_toast', { detail: { message: 'Please wait a moment before updating highlights again.', kind: 'warn' } }));\n      return;\n    }\n    lastFetchRef.current = now;\n\n    setLoadingSummary(true);\n    const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n    try {\n      // fetch stored messages for the thread, then POST them to /summary so we explicitly pass the chat\n      const msgsRes = await fetch(`${API_BASE}/messages/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n      if (!msgsRes.ok) {\n        throw new Error(\"Failed to load messages\");\n      }\n      const msgsJson = await msgsRes.json();\n      const conversation = (msgsJson.messages || []).map((m: any) => ({ role: m.role || \"user\", content: m.content || \"\" }));\n\n      // fetch any server-saved summary first so we can include it as prior context\n      let serverSavedSummary: any = {};\n      try {\n        const savedRes = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n        if (savedRes.ok) {\n          const sv = await savedRes.json();\n          serverSavedSummary = sv?.summary || {};\n        }\n      } catch (e) {\n        // ignore\n      }\n\n      const summaryRes = await fetch(`${API_BASE}/summary`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", Accept: \"application/json\" },\n        body: JSON.stringify({ conversation, last_summary: serverSavedSummary && (typeof serverSavedSummary === 'string' ? serverSavedSummary : JSON.stringify(serverSavedSummary)) }),\n      });\n\n      if (!summaryRes.ok) {\n        // try to extract error details from the response body\n        let errBody = \"\";\n        try {\n          const t = await summaryRes.text();\n          errBody = t;\n        } catch (e) {\n          errBody = String(e);\n        }\n        console.error(\"summary error\", summaryRes.status, errBody);\n        setFetchedSummary({\n          current_state: `Error loading summary (${summaryRes.status}): ${errBody}`,\n          what_we_uncovered: \"\",\n          suggested_next_steps: \"\",\n        });\n        } else {\n        const data = await summaryRes.json();\n        // backend returns a JSON string in `summary` field (structured inside); handle both shapes\n        let parsed: any = {};\n        try {\n          parsed = typeof data.summary === \"string\" ? JSON.parse(data.summary) : data;\n        } catch (e) {\n          parsed = data;\n        }\n        const base = {\n          current_state: parsed.current_state || parsed.summary?.current_state || \"\",\n          what_we_uncovered: parsed.what_we_uncovered || parsed.summary?.what_we_uncovered || \"\",\n          suggested_next_steps: parsed.suggested_next_steps || parsed.summary?.suggested_next_steps || \"\",\n        };\n        // Normalize fields: backend may return arrays (for bullets) or strings.\n        const normalizeField = (v: any) => {\n          if (Array.isArray(v)) return v.join(\"\\n\");\n          if (v === null || v === undefined) return \"\";\n          return String(v);\n        };\n        const normBase = {\n          current_state: normalizeField(base.current_state),\n          what_we_uncovered: normalizeField(base.what_we_uncovered),\n          suggested_next_steps: normalizeField(base.suggested_next_steps),\n        };\n        // Post-process summary fields to keep outputs concise and readable\n        const processedBase = {\n          current_state: processCurrentState(normBase.current_state),\n          what_we_uncovered: processWhatWeUncovered(normBase.what_we_uncovered),\n          suggested_next_steps: processSuggestedNextSteps(normBase.suggested_next_steps),\n        };\n        // apply any locally edited overrides and server-saved overrides (edits override processed defaults)\n        const edited = loadEditedSummary(threadId) || {};\n        let merged = { ...processedBase, ...edited };\n        try {\n          const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n          const savedRes = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(USER_ID)}/${encodeURIComponent(threadId)}`);\n          if (savedRes.ok) {\n            const sv = await savedRes.json();\n            const serverSummary = sv?.summary || {};\n            // normalize server-saved fields as well (they might be arrays)\n            const serverNorm: any = {};\n            if (serverSummary.current_state !== undefined) serverNorm.current_state = normalizeField(serverSummary.current_state);\n            if (serverSummary.what_we_uncovered !== undefined) serverNorm.what_we_uncovered = normalizeField(serverSummary.what_we_uncovered);\n            if (serverSummary.suggested_next_steps !== undefined) serverNorm.suggested_next_steps = normalizeField(serverSummary.suggested_next_steps);\n            merged = { ...merged, ...serverNorm };\n          }\n        } catch (e) {\n          // ignore server-side fetch errors and continue with local/processed summary\n        }\n        setFetchedSummary(merged);\n\n        // Dispatch suggestions to the ChatPanel so they become available as clickable inserts\n        try {\n          // helper: split concatenated Title-Case suggestions when punctuation is missing\n          const splitConcatenatedSuggestions = (txt: string) => {\n            if (!txt) return [] as string[];\n            const s = String(txt).replace(/\\s+/g, \" \").trim();\n            // if there are obvious separators, split on them\n            if (/[•\\-–—\\n,;|]/.test(s)) {\n              return s.split(/[\\n,;|•\\-–—]+/).map((t) => t.trim()).filter(Boolean);\n            }\n            // Heuristic: split where a lowercase/number is followed by a capitalized word\n            const parts = s.replace(/([a-z0-9])\\s+(?=[A-Z])/g, '$1|||').split('|||').map((t) => t.trim()).filter(Boolean);\n            if (parts.length > 1) return parts;\n            // Fallback: return the original as single-item array\n            return [s];\n          };\n\n          const rawSuggested = merged.suggested_next_steps || \"\";\n          let candidates = splitConcatenatedSuggestions(rawSuggested);\n          if (!candidates || candidates.length <= 1) {\n            // fallback to existing list extraction logic\n            candidates = extractListItems(rawSuggested);\n          }\n          // Stronger fallback: if we still have one long Title-Case string, try splitting on common action verbs\n          if (candidates.length === 1) {\n            const long = String(candidates[0] || \"\").trim();\n            const verbRegex = /\\b(Identify|Assess|Research|Define|Plan|Create|Organize|Explore|List|Set|Develop|Prioritize|Evaluate|Write|Map|Schedule|Clarify)\\b/gi;\n            const matches: { idx: number; word: string }[] = [];\n            // Use exec loop to avoid needing downlevelIteration / matchAll compatibility\n            verbRegex.lastIndex = 0;\n            let mm: RegExpExecArray | null;\n            while ((mm = verbRegex.exec(long)) !== null) {\n              matches.push({ idx: mm.index ?? 0, word: mm[0] });\n            }\n            if (matches.length > 1) {\n              const splits: string[] = [];\n              for (let i = 0; i < matches.length; i++) {\n                const start = matches[i].idx as number;\n                const end = i + 1 < matches.length ? matches[i+1].idx as number : long.length;\n                const piece = long.slice(start, end).trim();\n                if (piece) splits.push(piece);\n              }\n              if (splits.length > 1) candidates = splits;\n            }\n          }\n\n          const suggestionItems = candidates\n            .slice(0, 8)\n            .map((s) => {\n              const cleaned = String(s).replace(/^\\*+/, \"\").replace(/\\*+$/, \"\").trim();\n              return cleaned.slice(0, 120);\n            })\n            .filter(Boolean);\n          window.dispatchEvent(new CustomEvent(\"ai_suggestions\", { detail: { suggestions: suggestionItems } }));\n        } catch (e) {\n          // ignore dispatch errors\n        }\n      }\n    } catch (e) {\n      console.error(e);\n      setFetchedSummary({\n        current_state: \"Error contacting server\",\n        what_we_uncovered: \"\",\n        suggested_next_steps: \"\",\n      });\n    } finally {\n      setLoadingSummary(false);\n    }\n  }\n\n  // prevent accidental repeated Update Highlights calls by debouncing client-side\n  const lastFetchRef = useRef<number>(0);\n  function debouncedFetchSummary(threadId: string) {\n    // keep a light guard here; the main debounce/guard lives inside fetchSummaryForThread\n    const now = Date.now();\n    if (lastFetchRef.current && now - lastFetchRef.current < 60000) {\n      window.dispatchEvent(new CustomEvent('ai_toast', { detail: { message: 'Please wait a moment before updating highlights again.', kind: 'warn' } }));\n      return;\n    }\n    void fetchSummaryForThread(threadId);\n  }\n\n  // auto-load initial thread summary when selectedThreadId changes\n  useEffect(() => {\n    if (selectedThreadId) {\n      fetchSummaryForThread(selectedThreadId);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedThreadId]);\n\n  // helpers to start editing and save/cancel\n  function startEditSection(section: \"current\" | \"uncovered\" | \"suggested\") {\n    setEditingSection(section);\n    if (section === \"current\") setDraftCurrent(fetchedSummary.current_state ?? \"\");\n    if (section === \"uncovered\") setDraftUncovered(fetchedSummary.what_we_uncovered ?? \"\");\n    if (section === \"suggested\") setDraftSuggested(fetchedSummary.suggested_next_steps ?? \"\");\n  }\n\n  function cancelEditSection() {\n    setEditingSection(null);\n    setDraftCurrent(undefined);\n    setDraftUncovered(undefined);\n    setDraftSuggested(undefined);\n  }\n\n  function saveEditSection(section: \"current\" | \"uncovered\" | \"suggested\") {\n    const threadId = selectedThreadId;\n    const next = { ...fetchedSummary } as any;\n    if (section === \"current\") next.current_state = draftCurrent ?? next.current_state;\n    if (section === \"uncovered\") next.what_we_uncovered = draftUncovered ?? next.what_we_uncovered;\n    if (section === \"suggested\") next.suggested_next_steps = draftSuggested ?? next.suggested_next_steps;\n    setFetchedSummary(next);\n    // persist per-thread edits\n    persistEditedSummary(threadId, {\n      current_state: next.current_state,\n      what_we_uncovered: next.what_we_uncovered,\n      suggested_next_steps: next.suggested_next_steps,\n    });\n    // also POST edits to the backend so summaries persist across devices\n    try {\n      const USER_ID = localStorage.getItem(\"user_id\") || \"u1\";\n      void fetch(`${API_BASE}/summary/save`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ user_id: USER_ID, thread_id: threadId, summary: {\n          current_state: next.current_state,\n          what_we_uncovered: next.what_we_uncovered,\n          suggested_next_steps: next.suggested_next_steps,\n        }}),\n      });\n    } catch (e) {\n      // ignore network errors; client still has local copy\n    }\n    setEditingSection(null);\n  }\n\n  // Add the content of a summary tile as a new journal entry\n  function addTileToJournal(section: \"current\" | \"uncovered\" | \"suggested\") {\n    const titleMap: Record<string, string> = {\n      current: \"Current state\",\n      uncovered: \"What we’ve uncovered\",\n      suggested: \"Suggested next steps\",\n    };\n    let body = \"\";\n    if (section === \"current\") body = editingSection === \"current\" ? (draftCurrent ?? \"\") : (fetchedSummary.current_state ?? \"\");\n    if (section === \"uncovered\") body = editingSection === \"uncovered\" ? (draftUncovered ?? \"\") : (fetchedSummary.what_we_uncovered ?? \"\");\n    if (section === \"suggested\") body = editingSection === \"suggested\" ? (draftSuggested ?? \"\") : (fetchedSummary.suggested_next_steps ?? \"\");\n\n    const text = (body || \"\").toString().trim();\n    if (!text) {\n      window.dispatchEvent(new CustomEvent('ai_toast', { detail: { message: 'Nothing to add to journal.', kind: 'warn' } }));\n      return;\n    }\n\n    const entry: JournalEntry = {\n      entry_id: `j${Date.now()}`,\n      linked_session_id: \"\",\n      title: titleMap[section] || \"Summary\",\n      content: text,\n      created_at: new Date().toISOString(),\n      source: \"ai_suggested\",\n    };\n    const next = [entry, ...entries];\n    persistEntries(next);\n    // show toast with Undo action wired to a global undo event\n    window.dispatchEvent(new CustomEvent('ai_toast', {\n      detail: {\n        message: `Added \\\"${entry.title}\\\" to your journal.`,\n        kind: 'success',\n        actionLabel: 'Undo',\n        actionEvent: 'undo_journal_add',\n        actionPayload: { entry_id: entry.entry_id },\n      }\n    }));\n\n    // also set a local recentlyAdded state so the + button becomes an inline Undo for a short window\n    try {\n      setRecentlyAdded({ entry_id: entry.entry_id, section });\n      if (undoTimerRef.current) window.clearTimeout(undoTimerRef.current as any);\n      undoTimerRef.current = window.setTimeout(() => {\n        setRecentlyAdded(null);\n        undoTimerRef.current = null;\n      }, 6000) as unknown as number;\n    } catch (e) {\n      // ignore timer errors in some environments\n    }\n  }\n\n  // local undo handler (used when user clicks inline Undo button)\n  function undoRecentAdd(entryId?: string) {\n    const id = entryId || recentlyAdded?.entry_id;\n    if (!id) return;\n    setEntries((prev) => {\n      const next = prev.filter((p) => p.entry_id !== id);\n      try { localStorage.setItem('ai_journal_entries', JSON.stringify(next)); } catch (err) {}\n      return next;\n    });\n    setRecentlyAdded(null);\n    if (undoTimerRef.current) {\n      window.clearTimeout(undoTimerRef.current as any);\n      undoTimerRef.current = null;\n    }\n    window.dispatchEvent(new CustomEvent('ai_toast', { detail: { message: 'Removed entry.', kind: 'info' } }));\n  }\n\n  // Listen for undo events from the toast manager and remove the corresponding entry\n  useEffect(() => {\n    function handleUndo(e: any) {\n      const id = e.detail?.entry_id;\n      if (!id) return;\n      setEntries((prev) => {\n        const next = prev.filter((p) => p.entry_id !== id);\n        try { localStorage.setItem('ai_journal_entries', JSON.stringify(next)); } catch (err) {}\n        return next;\n      });\n      // inform user\n      window.dispatchEvent(new CustomEvent('ai_toast', { detail: { message: 'Removed entry.', kind: 'info' } }));\n    }\n    window.addEventListener('undo_journal_add', handleUndo as EventListener);\n    return () => window.removeEventListener('undo_journal_add', handleUndo as EventListener);\n  }, []);\n\n  // helper to render returned summary text as paragraphs or lists\n  const renderRichText = (txt?: string | null) => {\n    if (!txt) return <span className=\"muted\">—</span>;\n    // normalize line endings\n    const normalized = String(txt).replace(/\\r\\n/g, \"\\n\").trim();\n    if (!normalized) return <span className=\"muted\">—</span>;\n\n    const lines = normalized.split(/\\n+/).map((s) => s.trim()).filter(Boolean);\n\n    // detect bullet list (lines starting with '- ')\n    const isDashList = lines.every((l) => /^[-•*]\\s+/.test(l));\n    if (isDashList) {\n      return <ul>{lines.map((l, i) => <li key={i}>{l.replace(/^[-•*]\\s+/, \"\")}</li>)}</ul>;\n    }\n\n    // detect numbered list (lines starting with '1.' etc)\n    const isNumbered = lines.every((l) => /^\\d+\\./.test(l));\n    if (isNumbered) {\n      return <ol>{lines.map((l, i) => <li key={i}>{l.replace(/^\\d+\\.\\s*/, \"\")}</li>)}</ol>;\n    }\n\n    // otherwise render paragraphs for double-newline separated blocks\n    if (lines.length > 1) {\n      return <div>{lines.map((p, i) => <p key={i} style={{ marginTop: i === 0 ? 0 : 8 }}>{p}</p>)}</div>;\n    }\n\n    // single-line text\n    return <div>{normalized}</div>;\n  };\n\n  return (\n    <aside className=\"right-panel\" style={{ maxHeight: \"calc(100vh - 48px)\", overflow: \"auto\" }}>\n      <section className=\"right-panel__section\">\n        <div className=\"info-tile current-state\">\n          <div className=\"current-state-head\">\n            <div>\n              <div>\n                <button\n                  className=\"highlights-btn\"\n                  onClick={() => debouncedFetchSummary(selectedThreadId)}\n                  disabled={loadingSummary}\n                  aria-label=\"Update Highlights\"\n                >\n                  {loadingSummary ? <span className=\"ai-spinner\" aria-hidden /> : \"Update Highlights\"}\n                </button>\n              </div>\n              \n            </div>\n\n            <div className=\"state-controls\" style={{ display: \"flex\", gap: 8, alignItems: \"center\" }}>\n              <div className=\"state-ornament\" aria-hidden>\n                {/* decorative SVG */}\n                <svg width=\"54\" height=\"54\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path d=\"M12 2v6l4 2\" stroke=\"rgba(123,97,255,0.18)\" strokeWidth=\"1.4\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                  <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"rgba(123,97,255,0.06)\" strokeWidth=\"1.2\" />\n                </svg>\n              </div>\n\n              <div style={{ display: \"flex\", gap: 8, alignItems: \"center\" }}>\n                {threads.length > 0 ? (\n                  <select\n                    value={selectedThreadId}\n                    onChange={(e) => setSelectedThreadId(e.target.value)}\n                    className=\"thread-selector\"\n                  >\n                    {threads.map((t) => (\n                      <option key={t.thread_id} value={t.thread_id}>\n                        {t.title}\n                      </option>\n                    ))}\n                  </select>\n                ) : null}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"info-body\">\n            {/* mode hint removed as requested (removed 'Exploring options...' short description) */}\n\n            <div className=\"info-section uncovered uncovered-what\">\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                <div style={{ fontWeight: 600 }}>Current state</div>\n                <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                  {editingSection === 'current' ? (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => saveEditSection('current')}>Save</button>\n                      <button className=\"prompt-btn\" onClick={cancelEditSection}>Cancel</button>\n                    </>\n                  ) : (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => startEditSection('current')} aria-label=\"Edit\">✏️</button>\n                      {recentlyAdded?.section === 'current' && recentlyAdded.entry_id ? (\n                        <button className=\"prompt-btn undo-btn\" onClick={() => undoRecentAdd(recentlyAdded.entry_id)}>Undo</button>\n                      ) : (\n                        <button className=\"prompt-btn add-btn\" onClick={() => addTileToJournal('current')} aria-label=\"Add to journal\">\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden>\n                            <path d=\"M12 5v14M5 12h14\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                          </svg>\n                        </button>\n                      )}\n                    </>\n                  )}\n                </div>\n              </div>\n              <div className=\"summary-text\" style={{ fontSize: 16, lineHeight: 1.5, marginTop: 8 }}>\n                {editingSection === 'current' ? (\n                  <textarea value={draftCurrent ?? ''} onChange={(e) => setDraftCurrent(e.target.value)} style={{ width: '100%', minHeight: 120 }} />\n                ) : (\n                  renderRichText(fetchedSummary.current_state ?? (propSummary as any)?.current_state ?? (propSummary as any)?.summary_text ?? \"No summary yet. Click 'Update Highlights'.\")\n                )}\n              </div>\n            </div>\n\n\n            <div className=\"info-section uncovered\">\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                <h4 style={{ margin: 0 }}>What we’ve uncovered</h4>\n                <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                  {editingSection === 'uncovered' ? (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => saveEditSection('uncovered')}>Save</button>\n                      <button className=\"prompt-btn\" onClick={cancelEditSection}>Cancel</button>\n                    </>\n                  ) : (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => startEditSection('uncovered')} aria-label=\"Edit\">✏️</button>\n                      {recentlyAdded?.section === 'uncovered' && recentlyAdded.entry_id ? (\n                        <button className=\"prompt-btn undo-btn\" onClick={() => undoRecentAdd(recentlyAdded.entry_id)}>Undo</button>\n                      ) : (\n                        <button className=\"prompt-btn add-btn\" onClick={() => addTileToJournal('uncovered')} aria-label=\"Add to journal\">\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden>\n                            <path d=\"M12 5v14M5 12h14\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                          </svg>\n                        </button>\n                      )}\n                    </>\n                  )}\n                </div>\n              </div>\n              <div className=\"summary-text\" style={{ fontSize: 16, lineHeight: 1.5, marginTop: 8 }}>\n                {editingSection === 'uncovered' ? (\n                  <textarea value={draftUncovered ?? ''} onChange={(e) => setDraftUncovered(e.target.value)} style={{ width: '100%', minHeight: 120 }} />\n                ) : (\n                  renderRichText(fetchedSummary.what_we_uncovered ?? (propSummary && propSummary.key_points?.length ? propSummary.key_points.join(\"\\n\") : \"—\"))\n                )}\n              </div>\n            </div>\n\n            <div className=\"info-section suggestions\">\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                <h4 style={{ margin: 0 }}>Suggested next steps</h4>\n                <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                  {editingSection === 'suggested' ? (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => saveEditSection('suggested')}>Save</button>\n                      <button className=\"prompt-btn\" onClick={cancelEditSection}>Cancel</button>\n                    </>\n                  ) : (\n                    <>\n                      <button className=\"prompt-btn\" onClick={() => startEditSection('suggested')} aria-label=\"Edit\">✏️</button>\n                      {recentlyAdded?.section === 'suggested' && recentlyAdded.entry_id ? (\n                        <button className=\"prompt-btn undo-btn\" onClick={() => undoRecentAdd(recentlyAdded.entry_id)}>Undo</button>\n                      ) : (\n                        <button className=\"prompt-btn add-btn\" onClick={() => addTileToJournal('suggested')} aria-label=\"Add to journal\">\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" aria-hidden>\n                            <path d=\"M12 5v14M5 12h14\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\n                          </svg>\n                        </button>\n                      )}\n                    </>\n                  )}\n                </div>\n              </div>\n              <div className=\"summary-text\" style={{ fontSize: 16, lineHeight: 1.5, marginTop: 8 }}>\n                {editingSection === 'suggested' ? (\n                  <textarea value={draftSuggested ?? ''} onChange={(e) => setDraftSuggested(e.target.value)} style={{ width: '100%', minHeight: 120 }} />\n                ) : (\n                  renderRichText(fetchedSummary.suggested_next_steps ?? \"—\")\n                )}\n\n              {/* suggestion chips removed here — suggestions are dispatched to ChatPanel for insertion into the chat input */}\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Journal tile */}\n      <section className=\"right-panel__section\">\n        <div\n          className=\"journal-tile\"\n          role=\"button\"\n          onClick={() => setOpenFull(true)}\n          aria-pressed={openFull}\n          tabIndex={0}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") setOpenFull(true);\n          }}\n        >\n          <div className=\"journal-icon big\" aria-hidden>\n            📔\n          </div>\n          <div className=\"journal-label\">Your Journal</div>\n        </div>\n      </section>\n\n      {openFull && typeof document !== \"undefined\" && document.body\n        ? createPortal(\n            <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\" onClick={() => setOpenFull(false)}>\n              <div\n                className={`modal full-journal`}\n                style={{ width: `${modalWidth}vw` }}\n                onClick={(e) => e.stopPropagation()}\n              >\n                <div className=\"modal-header\">\n                  <h3>Your Journal</h3>\n                  <div style={{ display: \"flex\", gap: 12, alignItems: \"center\" }}>\n                    <label className=\"muted\" style={{ fontSize: \"0.85rem\" }}>Width</label>\n                    <input\n                      type=\"range\"\n                      min={60}\n                      max={95}\n                      value={modalWidth}\n                      onChange={(e) => setModalWidth(Number(e.target.value))}\n                    />\n                    <label className=\"muted\" style={{ fontSize: \"0.85rem\" }}>Font</label>\n                    <select className=\"font-picker\" value={fontChoice} onChange={(e) => setFontChoice(e.target.value)} aria-label=\"Journal font picker\">\n                      <option value=\"Patrick Hand\">Patrick Hand</option>\n                      <option value=\"Indie Flower\">Indie Flower</option>\n                      <option value=\"Caveat\">Caveat</option>\n                    </select>\n                    <button className=\"prompt-btn\" onClick={() => setOpenFull(false)}>Close</button>\n                  </div>\n                </div>\n\n                <div className=\"modal-body\" style={{ alignItems: \"stretch\" }}>\n                  <div className=\"journal-list\" style={{ width: \"300px\" }}>\n                    <div className=\"journal-list-header muted\">Entries</div>\n                    <ul>\n                      {entries.map((e) => (\n                        <li key={e.entry_id} className={`journal-list-item ${selectedEntry?.entry_id === e.entry_id ? \"active\" : \"\"}`} onClick={() => setSelectedEntry(e)}>\n                          <div className=\"jl-title\">{e.title}</div>\n                          <div className=\"jl-date muted\">{new Date(e.created_at).toLocaleDateString()}</div>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n\n                  <div className=\"journal-right\" style={{ flex: 1 }}>\n                    <div className=\"journal-new-row\" style={{ display: \"flex\", flexDirection: \"column\", gap: 8 }}>\n                      <div style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n                        <h4 style={{ margin: 0 }}>New Entry</h4>\n                        <button className=\"prompt-btn\" onClick={() => { setShowNewForm((s) => !s); setNewTitle(\"\"); setNewContent(\"\"); }}>\n                          {showNewForm ? \"Cancel\" : \"New\"}\n                        </button>\n                      </div>\n\n                      {showNewForm && (\n                        <div style={{ display: \"flex\", gap: 12 }}>\n                          <div style={{ width: 160 }}>\n                            <input className=\"journal-input title-input\" placeholder=\"Title\" value={newTitle} onChange={(e) => setNewTitle(e.target.value)} />\n                          </div>\n                          <div style={{ flex: 1 }}>\n                            <textarea className=\"journal-textarea\" placeholder=\"Write your entry...\" value={newContent} onChange={(e) => setNewContent(e.target.value)} style={{ fontFamily: fontChoice }} />\n                            <div style={{ display: \"flex\", gap: 8, marginTop: 8 }}>\n                              <button className=\"prompt-btn\" onClick={() => {\n                                const t = newTitle;\n                                const c = newContent;\n                                if (!t.trim() && !c.trim()) return;\n                                const entry: JournalEntry = { entry_id: `j${Date.now()}`, linked_session_id: \"\", title: t.trim() || \"Untitled\", content: c.trim(), created_at: new Date().toISOString(), source: \"user_written\" };\n                                const next = [entry, ...entries];\n                                persistEntries(next);\n                                setSelectedEntry(entry);\n                                setShowNewForm(false);\n                                setNewTitle(\"\");\n                                setNewContent(\"\");\n                              }}>Save Entry</button>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"journal-preview\" style={{ marginTop: 12 }}>\n                      {selectedEntry ? (\n                        editingEntryId === selectedEntry.entry_id ? (\n                          <div className=\"notebook-card\">\n                            <div className=\"note-head\">\n                              <div style={{ display: \"flex\", gap: 12, alignItems: \"center\" }}>\n                                <input className=\"journal-input title-input\" value={editTitle} onChange={(e) => setEditTitle(e.target.value)} />\n                                <div style={{ marginLeft: \"auto\", display: \"flex\", gap: 8 }}>\n                                  <button className=\"prompt-btn\" onClick={() => saveEdit(selectedEntry.entry_id)}>Save</button>\n                                  <button className=\"prompt-btn\" onClick={cancelEdit}>Cancel</button>\n                                </div>\n                              </div>\n                              <div className=\"muted\">{new Date(selectedEntry.created_at).toLocaleString()}</div>\n                            </div>\n                            <div className=\"note-body\">\n                              <textarea className=\"journal-textarea\" value={editContent} onChange={(e) => setEditContent(e.target.value)} style={{ fontFamily: fontChoice }} />\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"notebook-card\">\n                            <div className=\"note-head\" style={{ display: \"flex\", alignItems: \"center\", gap: 12 }}>\n                              <strong>{selectedEntry.title}</strong>\n                              <div className=\"muted\">{new Date(selectedEntry.created_at).toLocaleString()}</div>\n                              <div style={{ marginLeft: \"auto\", display: \"flex\", gap: 8 }}>\n                                <button className=\"prompt-btn\" onClick={() => startEdit(selectedEntry)}>Edit</button>\n                                <button className=\"prompt-btn\" onClick={() => deleteEntry(selectedEntry.entry_id)}>Delete</button>\n                              </div>\n                            </div>\n                            <div className=\"note-body\">\n                              {selectedEntry.content.split(\"\\n\").map((ln, i) => (\n                                <div key={i} className=\"note-line\" style={{ fontFamily: fontChoice }}>{ln}</div>\n                              ))}\n                            </div>\n                          </div>\n                        )\n                      ) : (\n                        <div className=\"muted\">Select an entry from the left to view it here.</div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>,\n            document.body\n          )\n        : null}\n    </aside>\n  );\n}\n\n// Small form component for creating a journal entry (kept local)\nfunction JournalForm({ onSave }: { onSave: (e: JournalEntry) => void }) {\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n\n  function handleSave() {\n    if (!title.trim() && !content.trim()) return;\n    const entry: JournalEntry = {\n      entry_id: `j${Date.now()}`,\n      linked_session_id: \"\",\n      title: title.trim() || \"Untitled\",\n      content: content.trim(),\n      created_at: new Date().toISOString(),\n      source: \"user_written\",\n    };\n    onSave(entry);\n    setTitle(\"\");\n    setContent(\"\");\n  }\n\n  return (\n    <div>\n      <input className=\"journal-input\" placeholder=\"Title\" value={title} onChange={(e) => setTitle(e.target.value)} />\n      <textarea className=\"journal-textarea\" placeholder=\"Write your entry...\" value={content} onChange={(e) => setContent(e.target.value)} />\n      <div style={{ display: \"flex\", gap: 8 }}>\n        <button className=\"prompt-btn\" onClick={handleSave}>Save Entry</button>\n      </div>\n    </div>\n  );\n}"],"mappings":";;;AACA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AACnD,SAASC,YAAY,QAAQ,WAAW;AACxC,SAASC,cAAc,IAAIC,aAAa,QAAQ,oBAAoB;AACpE,OAAO,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAa1B,MAAMC,UAOL,GAAG;EACFC,iBAAiB,EAAE;IACjBC,KAAK,EAAE,aAAa;IACpBC,WAAW,EAAE,yCAAyC;IACtDC,WAAW,EAAE,CACX,8BAA8B,EAC9B,4BAA4B,EAC5B,4BAA4B;EAEhC,CAAC;EACDC,WAAW,EAAE;IACXH,KAAK,EAAE,aAAa;IACpBC,WAAW,EAAE,8DAA8D;IAC3EC,WAAW,EAAE,CACX,iCAAiC,EACjC,uBAAuB,EACvB,+CAA+C;EAEnD,CAAC;EACDE,UAAU,EAAE;IACVJ,KAAK,EAAE,YAAY;IACnBC,WAAW,EAAE,6CAA6C;IAC1DC,WAAW,EAAE,CACX,mBAAmB,EACnB,wBAAwB,EACxB,6BAA6B;EAEjC,CAAC;EACDG,QAAQ,EAAE;IACRL,KAAK,EAAE,iBAAiB;IACxBC,WAAW,EAAE,uDAAuD;IACpEC,WAAW,EAAE,CACX,oBAAoB,EACpB,yBAAyB,EACzB,iCAAiC;EAErC;AACF,CAAC;AAED,eAAe,SAASI,UAAUA,CAAC;EACjCC,IAAI;EACJC,OAAO,EAAEC,WAAW,GAAG,IAAI;EAC3BC,OAAO,GAAG;AACK,CAAC,EAAE;EAAAC,EAAA;EAAA,IAAAC,oBAAA,EAAAC,SAAA,EAAAC,SAAA,EAAAC,IAAA,EAAAC,KAAA,EAAAC,sBAAA,EAAAC,sBAAA,EAAAC,qBAAA,EAAAC,sBAAA;EAClB,MAAMC,UAAU,GAAGd,IAAI,GAAGT,UAAU,CAACS,IAAI,CAAC,GAAG,IAAI;;EAEjD;EACA,MAAMe,QAAQ,GAAI,OAAOC,MAAM,KAAK,WAAW,IAAKA,MAAM,CAASD,QAAQ,IAAME,OAAO,CAACC,GAAG,CAACC,kBAA6B,IAAI,uBAAuB;EAErJ,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGxC,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACyC,OAAO,EAAEC,UAAU,CAAC,GAAG1C,QAAQ,CAAiB,EAAE,CAAC;EAC1D,MAAM,CAAC2C,aAAa,EAAEC,gBAAgB,CAAC,GAAG5C,QAAQ,CAAsB,IAAI,CAAC;EAC7E,MAAM,CAAC6C,UAAU,EAAEC,aAAa,CAAC,GAAG9C,QAAQ,CAAS,EAAE,CAAC,CAAC,CAAC;EAC1D,MAAM,CAAC+C,WAAW,EAAEC,cAAc,CAAC,GAAGhD,QAAQ,CAAU,KAAK,CAAC;EAC9D,MAAM,CAACiD,QAAQ,EAAEC,WAAW,CAAC,GAAGlD,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAACmD,UAAU,EAAEC,aAAa,CAAC,GAAGpD,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAACqD,UAAU,EAAEC,aAAa,CAAC,GAAGtD,QAAQ,CAAS,cAAc,CAAC;;EAEpE;EACA,MAAM,CAACuD,cAAc,EAAEC,iBAAiB,CAAC,GAAGxD,QAAQ,CAAgB,IAAI,CAAC;EACzE,MAAM,CAACyD,SAAS,EAAEC,YAAY,CAAC,GAAG1D,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAAC2D,WAAW,EAAEC,cAAc,CAAC,GAAG5D,QAAQ,CAAC,EAAE,CAAC;;EAElD;EACA,MAAM,CAAC6D,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG9D,QAAQ,EAAAwB,oBAAA,GACtDF,OAAO,aAAPA,OAAO,wBAAAG,SAAA,GAAPH,OAAO,CAAG,CAAC,CAAC,cAAAG,SAAA,uBAAZA,SAAA,CAAcsC,SAAS,cAAAvC,oBAAA,cAAAA,oBAAA,GAAI,IAC7B,CAAC;EACD,MAAM,CAACwC,cAAc,EAAEC,iBAAiB,CAAC,GAAGjE,QAAQ,CAAC,KAAK,CAAC;EAC3D,MAAM,CAACkE,cAAc,EAAEC,iBAAiB,CAAC,GAAGnE,QAAQ,CAIjD,CAAC,CAAC,CAAC;EACN,MAAM,CAACoE,cAAc,EAAEC,iBAAiB,CAAC,GAAGrE,QAAQ,CAA+C,IAAI,CAAC;EACxG,MAAM,CAACsE,YAAY,EAAEC,eAAe,CAAC,GAAGvE,QAAQ,CAAqBwE,SAAS,CAAC;EAC/E,MAAM,CAACC,cAAc,EAAEC,iBAAiB,CAAC,GAAG1E,QAAQ,CAAqBwE,SAAS,CAAC;EACnF,MAAM,CAACG,cAAc,EAAEC,iBAAiB,CAAC,GAAG5E,QAAQ,CAAqBwE,SAAS,CAAC;EACnF,MAAM,CAACK,aAAa,EAAEC,gBAAgB,CAAC,GAAG9E,QAAQ,CAA8E,IAAI,CAAC;EACrI,MAAM+E,YAAY,GAAG7E,MAAM,CAAgB,IAAI,CAAC;EAEhD,MAAM8E,eAAe,GAAG,oBAAoB;EAE5C,SAASC,iBAAiBA,CAACC,QAAgB,EAAE;IAC3C,IAAI;MACF,MAAMC,GAAG,GAAG,GAAGH,eAAe,GAAGE,QAAQ,EAAE;MAC3C,MAAME,GAAG,GAAGC,YAAY,CAACC,OAAO,CAACH,GAAG,CAAC;MACrC,IAAI,CAACC,GAAG,EAAE,OAAO,IAAI;MACrB,MAAMG,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC;MAC9B,OAAOG,MAAM;IACf,CAAC,CAAC,OAAOG,CAAC,EAAE;MACV,OAAO,IAAI;IACb;EACF;EAEA,SAASC,oBAAoBA,CAACT,QAAgB,EAAEU,IAAS,EAAE;IACzD,IAAI;MACF,MAAMT,GAAG,GAAG,GAAGH,eAAe,GAAGE,QAAQ,EAAE;MAC3CG,YAAY,CAACQ,OAAO,CAACV,GAAG,EAAEK,IAAI,CAACM,SAAS,CAACF,IAAI,CAAC,CAAC;IACjD,CAAC,CAAC,OAAOF,CAAC,EAAE;MACV;IAAA;EAEJ;;EAEA;EACAzF,SAAS,CAAC,MAAM;IACd,IAAI;MACF,MAAMmF,GAAG,GAAGC,YAAY,CAACC,OAAO,CAAC,oBAAoB,CAAC;MACtD,IAAIF,GAAG,EAAE;QACP1C,UAAU,CAAC8C,IAAI,CAACC,KAAK,CAACL,GAAG,CAAC,CAAC;MAC7B,CAAC,MAAM;QACL1C,UAAU,CAACrC,aAAa,CAAC;MAC3B;IACF,CAAC,CAAC,OAAOqF,CAAC,EAAE;MACVhD,UAAU,CAACrC,aAAa,CAAC;IAC3B;EACF,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,SAAS0F,cAAcA,CAACC,IAAoB,EAAE;IAC5CtD,UAAU,CAACsD,IAAI,CAAC;IAChB,IAAI;MACFX,YAAY,CAACQ,OAAO,CAAC,oBAAoB,EAAEL,IAAI,CAACM,SAAS,CAACE,IAAI,CAAC,CAAC;IAClE,CAAC,CAAC,OAAON,CAAC,EAAE;MACV;IAAA;EAEJ;EAEA,SAASO,SAASA,CAACC,KAAmB,EAAE;IACtCtD,gBAAgB,CAACsD,KAAK,CAAC;IACvB1C,iBAAiB,CAAC0C,KAAK,CAACC,QAAQ,CAAC;IACjCzC,YAAY,CAACwC,KAAK,CAACE,KAAK,CAAC;IACzBxC,cAAc,CAACsC,KAAK,CAACG,OAAO,CAAC;EAC/B;EAEA,SAASC,QAAQA,CAACC,OAAe,EAAE;IAAA,IAAAC,UAAA;IACjC,MAAMR,IAAI,GAAGvD,OAAO,CAACgE,GAAG,CAAEC,EAAE,IAC1BA,EAAE,CAACP,QAAQ,KAAKI,OAAO,GAAG;MAAE,GAAGG,EAAE;MAAEN,KAAK,EAAE3C,SAAS;MAAE4C,OAAO,EAAE1C;IAAY,CAAC,GAAG+C,EAChF,CAAC;IACDX,cAAc,CAACC,IAAI,CAAC;IACpBxC,iBAAiB,CAAC,IAAI,CAAC;IACvB,MAAMmD,OAAO,IAAAH,UAAA,GAAGR,IAAI,CAACY,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACV,QAAQ,KAAKI,OAAO,CAAC,cAAAC,UAAA,cAAAA,UAAA,GAAI,IAAI;IAChE5D,gBAAgB,CAAC+D,OAAO,CAAC;EAC3B;EAEA,SAASG,UAAUA,CAAA,EAAG;IACpBtD,iBAAiB,CAAC,IAAI,CAAC;IACvBE,YAAY,CAAC,EAAE,CAAC;IAChBE,cAAc,CAAC,EAAE,CAAC;EACpB;EAEA,SAASmD,WAAWA,CAACR,OAAe,EAAE;IACpC,IAAI,CAACpE,MAAM,CAAC6E,OAAO,CAAC,4BAA4B,CAAC,EAAE;IACnD,MAAMhB,IAAI,GAAGvD,OAAO,CAACwE,MAAM,CAAEvB,CAAC,IAAKA,CAAC,CAACS,QAAQ,KAAKI,OAAO,CAAC;IAC1DR,cAAc,CAACC,IAAI,CAAC;IACpB,IAAI,CAAArD,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEwD,QAAQ,MAAKI,OAAO,EAAE;MAAA,IAAAW,MAAA;MACvCtE,gBAAgB,EAAAsE,MAAA,GAAClB,IAAI,CAAC,CAAC,CAAC,cAAAkB,MAAA,cAAAA,MAAA,GAAI,IAAI,CAAC;IACnC;EACF;EAEA,MAAMC,WAAW,IAAAzF,SAAA,GAAGe,OAAO,CAAC,CAAC,CAAC,cAAAf,SAAA,cAAAA,SAAA,GAAI,IAAI;;EAEtC;EACAzB,SAAS,CAAC,MAAM;IACd,IAAI;MACF,MAAMmH,CAAC,GAAG/B,YAAY,CAACC,OAAO,CAAC,wBAAwB,CAAC;MACxD,IAAI8B,CAAC,EAAEtE,aAAa,CAACuE,MAAM,CAACD,CAAC,CAAC,CAAC;IACjC,CAAC,CAAC,OAAO1B,CAAC,EAAE,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAENzF,SAAS,CAAC,MAAM;IACd,IAAI;MACF,MAAMqH,CAAC,GAAGjC,YAAY,CAACC,OAAO,CAAC,iBAAiB,CAAC;MACjD,IAAIgC,CAAC,EAAEhE,aAAa,CAACgE,CAAC,CAAC;IACzB,CAAC,CAAC,OAAO5B,CAAC,EAAE,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAENzF,SAAS,CAAC,MAAM;IACd,IAAI;MACFoF,YAAY,CAACQ,OAAO,CAAC,wBAAwB,EAAE0B,MAAM,CAAC1E,UAAU,CAAC,CAAC;IACpE,CAAC,CAAC,OAAO6C,CAAC,EAAE,CAAC;EACf,CAAC,EAAE,CAAC7C,UAAU,CAAC,CAAC;EAEhB5C,SAAS,CAAC,MAAM;IACd,IAAI;MACFoF,YAAY,CAACQ,OAAO,CAAC,iBAAiB,EAAExC,UAAU,CAAC;IACrD,CAAC,CAAC,OAAOqC,CAAC,EAAE,CAAC;EACf,CAAC,EAAE,CAACrC,UAAU,CAAC,CAAC;;EAEhB;EACApD,SAAS,CAAC,MAAM;IACd,IAAIqB,OAAO,IAAIA,OAAO,CAACkG,MAAM,GAAG,CAAC,EAAE;MACjC1D,mBAAmB,CAAE2D,CAAC,IAAKA,CAAC,IAAInG,OAAO,CAAC,CAAC,CAAC,CAACyC,SAAS,CAAC;IACvD;EACF,CAAC,EAAE,CAACzC,OAAO,CAAC,CAAC;;EAEb;EACA,MAAMoG,cAAc,GAAGA,CAACC,IAA+B,EAAEC,YAAY,GAAG,CAAC,EAAEC,QAAQ,GAAG,EAAE,KAAK;IAC3F,IAAI,CAACF,IAAI,EAAE,OAAO,EAAE;IACpB,MAAMG,OAAO,GAAGP,MAAM,CAACI,IAAI,CAAC,CAACI,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACC,IAAI,CAAC,CAAC;IACxD,IAAI,CAACF,OAAO,EAAE,OAAO,EAAE;IACvB;IACA,MAAMG,SAAS,GAAGH,OAAO,CAACI,KAAK,CAAC,eAAe,CAAC;IAChD,MAAMC,KAAK,GAAGF,SAAS,CAACG,KAAK,CAAC,CAAC,EAAER,YAAY,CAAC,CAACS,IAAI,CAAC,GAAG,CAAC;IACxD,MAAMC,KAAK,GAAGH,KAAK,CAACD,KAAK,CAAC,KAAK,CAAC,CAACjB,MAAM,CAACsB,OAAO,CAAC;IAChD,IAAID,KAAK,CAACd,MAAM,GAAGK,QAAQ,EAAE,OAAOS,KAAK,CAACF,KAAK,CAAC,CAAC,EAAEP,QAAQ,CAAC,CAACQ,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG;IAC5E,OAAOF,KAAK;EACd,CAAC;EAED,MAAMK,gBAAgB,GAAIb,IAA+B,IAAK;IAC5D,IAAI,CAACA,IAAI,EAAE,OAAO,EAAE;IACpB,MAAMc,UAAU,GAAGlB,MAAM,CAACI,IAAI,CAAC,CAACI,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAACC,IAAI,CAAC,CAAC;IAC7D,IAAI,CAACS,UAAU,EAAE,OAAO,EAAE;IAC1B,MAAMC,KAAK,GAAGD,UAAU,CAACP,KAAK,CAAC,KAAK,CAAC,CAACzB,GAAG,CAAEkC,CAAC,IAAKA,CAAC,CAACX,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;IAC1E;IACA,MAAMK,OAAO,GAAGF,KAAK,CAACzB,MAAM,CAAE0B,CAAC,IAAK,WAAW,CAACE,IAAI,CAACF,CAAC,CAAC,IAAI,eAAe,CAACE,IAAI,CAACF,CAAC,CAAC,CAAC;IACnF,IAAIC,OAAO,CAACpB,MAAM,EAAE;MAClB,OAAOoB,OAAO,CAACnC,GAAG,CAAEkC,CAAC,IAAKA,CAAC,CAACZ,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;IACpE;IACA;IACA,MAAMC,SAAS,GAAGQ,UAAU,CAACP,KAAK,CAAC,eAAe,CAAC,CAACzB,GAAG,CAACgB,CAAC,IAAIA,CAAC,CAACO,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;IACtF,IAAIN,SAAS,CAACT,MAAM,GAAG,CAAC,EAAE,OAAOS,SAAS;IAC1C;IACA,MAAMa,KAAK,GAAGL,UAAU,CAACP,KAAK,CAAC,YAAY,CAAC,CAACzB,GAAG,CAACsC,CAAC,IAAIA,CAAC,CAACf,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;IAC/E,OAAOO,KAAK,CAACtB,MAAM,GAAGsB,KAAK,GAAG,CAACL,UAAU,CAAC;EAC5C,CAAC;EAED,MAAMO,mBAAmB,GAAIrB,IAA+B,IAAK;IAC/D;IACA,OAAOD,cAAc,CAACC,IAAI,EAAE,CAAC,EAAE,EAAE,CAAC;EACpC,CAAC;EAED,MAAMsB,sBAAsB,GAAItB,IAA+B,IAAK;IAClE,MAAMuB,KAAK,GAAGV,gBAAgB,CAACb,IAAI,CAAC;IACpC,MAAMwB,IAAI,GAAGD,KAAK,CAACd,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;IAC9B,IAAIe,IAAI,CAAC3B,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;IAChC;IACA,OAAO2B,IAAI,CAAC1C,GAAG,CAAE2C,EAAE,IAAK,KAAKA,EAAE,EAAE,CAAC,CAACf,IAAI,CAAC,IAAI,CAAC;EAC/C,CAAC;EAED,MAAMgB,yBAAyB,GAAI1B,IAA+B,IAAK;IACrE,MAAMuB,KAAK,GAAGV,gBAAgB,CAACb,IAAI,CAAC;IACpC,MAAMwB,IAAI,GAAGD,KAAK,CAACd,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC3B,GAAG,CAAE2C,EAAE,IAAK;MACzC;MACA,MAAME,KAAK,GAAGF,EAAE,CAAClB,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAACF,IAAI,CAAC,CAAC;MAC5C;MACA,MAAMM,KAAK,GAAGgB,KAAK,CAACpB,KAAK,CAAC,KAAK,CAAC,CAACE,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;MACvD,OAAOC,KAAK;IACd,CAAC,CAAC;IACF,IAAIa,IAAI,CAAC3B,MAAM,KAAK,CAAC,EAAE,OAAO,EAAE;IAChC,OAAO2B,IAAI,CAAC1C,GAAG,CAAE8C,CAAC,IAAK,KAAKA,CAAC,EAAE,CAAC,CAAClB,IAAI,CAAC,IAAI,CAAC;EAC7C,CAAC;EAED,eAAemB,qBAAqBA,CAACtE,QAAgB,EAAE;IACrD;IACA,MAAMuE,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAIE,YAAY,CAACC,OAAO,IAAIH,GAAG,GAAGE,YAAY,CAACC,OAAO,GAAG,KAAK,EAAE;MAC9DzH,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;QAAEC,MAAM,EAAE;UAAEC,OAAO,EAAE,wDAAwD;UAAEC,IAAI,EAAE;QAAO;MAAE,CAAC,CAAC,CAAC;MAClJ;IACF;IACAN,YAAY,CAACC,OAAO,GAAGH,GAAG;IAE1BxF,iBAAiB,CAAC,IAAI,CAAC;IACvB,MAAMiG,OAAO,GAAG7E,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI;IACvD,IAAI;MACF;MACA,MAAM6E,OAAO,GAAG,MAAMC,KAAK,CAAC,GAAGlI,QAAQ,aAAamI,kBAAkB,CAACH,OAAO,CAAC,IAAIG,kBAAkB,CAACnF,QAAQ,CAAC,EAAE,CAAC;MAClH,IAAI,CAACiF,OAAO,CAACG,EAAE,EAAE;QACf,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;MAC5C;MACA,MAAMC,QAAQ,GAAG,MAAML,OAAO,CAACM,IAAI,CAAC,CAAC;MACrC,MAAMC,YAAY,GAAG,CAACF,QAAQ,CAACG,QAAQ,IAAI,EAAE,EAAElE,GAAG,CAAEmE,CAAM,KAAM;QAAEC,IAAI,EAAED,CAAC,CAACC,IAAI,IAAI,MAAM;QAAExE,OAAO,EAAEuE,CAAC,CAACvE,OAAO,IAAI;MAAG,CAAC,CAAC,CAAC;;MAEtH;MACA,IAAIyE,kBAAuB,GAAG,CAAC,CAAC;MAChC,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAMX,KAAK,CAAC,GAAGlI,QAAQ,kBAAkBmI,kBAAkB,CAACH,OAAO,CAAC,IAAIG,kBAAkB,CAACnF,QAAQ,CAAC,EAAE,CAAC;QACxH,IAAI6F,QAAQ,CAACT,EAAE,EAAE;UACf,MAAMU,EAAE,GAAG,MAAMD,QAAQ,CAACN,IAAI,CAAC,CAAC;UAChCK,kBAAkB,GAAG,CAAAE,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAE5J,OAAO,KAAI,CAAC,CAAC;QACxC;MACF,CAAC,CAAC,OAAOsE,CAAC,EAAE;QACV;MAAA;MAGF,MAAMuF,UAAU,GAAG,MAAMb,KAAK,CAAC,GAAGlI,QAAQ,UAAU,EAAE;QACpDgJ,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE,kBAAkB;UAAEC,MAAM,EAAE;QAAmB,CAAC;QAC3EC,IAAI,EAAE7F,IAAI,CAACM,SAAS,CAAC;UAAE4E,YAAY;UAAEY,YAAY,EAAER,kBAAkB,KAAK,OAAOA,kBAAkB,KAAK,QAAQ,GAAGA,kBAAkB,GAAGtF,IAAI,CAACM,SAAS,CAACgF,kBAAkB,CAAC;QAAE,CAAC;MAC/K,CAAC,CAAC;MAEF,IAAI,CAACG,UAAU,CAACX,EAAE,EAAE;QAClB;QACA,IAAIiB,OAAO,GAAG,EAAE;QAChB,IAAI;UACF,MAAMhC,CAAC,GAAG,MAAM0B,UAAU,CAACtD,IAAI,CAAC,CAAC;UACjC4D,OAAO,GAAGhC,CAAC;QACb,CAAC,CAAC,OAAO7D,CAAC,EAAE;UACV6F,OAAO,GAAGhE,MAAM,CAAC7B,CAAC,CAAC;QACrB;QACA8F,OAAO,CAACC,KAAK,CAAC,eAAe,EAAER,UAAU,CAACS,MAAM,EAAEH,OAAO,CAAC;QAC1DpH,iBAAiB,CAAC;UAChBwH,aAAa,EAAE,0BAA0BV,UAAU,CAACS,MAAM,MAAMH,OAAO,EAAE;UACzEK,iBAAiB,EAAE,EAAE;UACrBC,oBAAoB,EAAE;QACxB,CAAC,CAAC;MACF,CAAC,MAAM;QAAA,IAAAC,eAAA,EAAAC,gBAAA,EAAAC,gBAAA;QACP,MAAMpG,IAAI,GAAG,MAAMqF,UAAU,CAACR,IAAI,CAAC,CAAC;QACpC;QACA,IAAIlF,MAAW,GAAG,CAAC,CAAC;QACpB,IAAI;UACFA,MAAM,GAAG,OAAOK,IAAI,CAACxE,OAAO,KAAK,QAAQ,GAAGoE,IAAI,CAACC,KAAK,CAACG,IAAI,CAACxE,OAAO,CAAC,GAAGwE,IAAI;QAC7E,CAAC,CAAC,OAAOF,CAAC,EAAE;UACVH,MAAM,GAAGK,IAAI;QACf;QACA,MAAMqG,IAAI,GAAG;UACXN,aAAa,EAAEpG,MAAM,CAACoG,aAAa,MAAAG,eAAA,GAAIvG,MAAM,CAACnE,OAAO,cAAA0K,eAAA,uBAAdA,eAAA,CAAgBH,aAAa,KAAI,EAAE;UAC1EC,iBAAiB,EAAErG,MAAM,CAACqG,iBAAiB,MAAAG,gBAAA,GAAIxG,MAAM,CAACnE,OAAO,cAAA2K,gBAAA,uBAAdA,gBAAA,CAAgBH,iBAAiB,KAAI,EAAE;UACtFC,oBAAoB,EAAEtG,MAAM,CAACsG,oBAAoB,MAAAG,gBAAA,GAAIzG,MAAM,CAACnE,OAAO,cAAA4K,gBAAA,uBAAdA,gBAAA,CAAgBH,oBAAoB,KAAI;QAC/F,CAAC;QACD;QACA,MAAMK,cAAc,GAAIC,CAAM,IAAK;UACjC,IAAIC,KAAK,CAACC,OAAO,CAACF,CAAC,CAAC,EAAE,OAAOA,CAAC,CAAC9D,IAAI,CAAC,IAAI,CAAC;UACzC,IAAI8D,CAAC,KAAK,IAAI,IAAIA,CAAC,KAAK3H,SAAS,EAAE,OAAO,EAAE;UAC5C,OAAO+C,MAAM,CAAC4E,CAAC,CAAC;QAClB,CAAC;QACD,MAAMG,QAAQ,GAAG;UACfX,aAAa,EAAEO,cAAc,CAACD,IAAI,CAACN,aAAa,CAAC;UACjDC,iBAAiB,EAAEM,cAAc,CAACD,IAAI,CAACL,iBAAiB,CAAC;UACzDC,oBAAoB,EAAEK,cAAc,CAACD,IAAI,CAACJ,oBAAoB;QAChE,CAAC;QACD;QACA,MAAMU,aAAa,GAAG;UACpBZ,aAAa,EAAE3C,mBAAmB,CAACsD,QAAQ,CAACX,aAAa,CAAC;UAC1DC,iBAAiB,EAAE3C,sBAAsB,CAACqD,QAAQ,CAACV,iBAAiB,CAAC;UACrEC,oBAAoB,EAAExC,yBAAyB,CAACiD,QAAQ,CAACT,oBAAoB;QAC/E,CAAC;QACD;QACA,MAAMW,MAAM,GAAGvH,iBAAiB,CAACC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChD,IAAIuH,MAAM,GAAG;UAAE,GAAGF,aAAa;UAAE,GAAGC;QAAO,CAAC;QAC5C,IAAI;UACF,MAAMtC,OAAO,GAAG7E,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI;UACvD,MAAMyF,QAAQ,GAAG,MAAMX,KAAK,CAAC,GAAGlI,QAAQ,kBAAkBmI,kBAAkB,CAACH,OAAO,CAAC,IAAIG,kBAAkB,CAACnF,QAAQ,CAAC,EAAE,CAAC;UACxH,IAAI6F,QAAQ,CAACT,EAAE,EAAE;YACf,MAAMU,EAAE,GAAG,MAAMD,QAAQ,CAACN,IAAI,CAAC,CAAC;YAChC,MAAMiC,aAAa,GAAG,CAAA1B,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAE5J,OAAO,KAAI,CAAC,CAAC;YACvC;YACA,MAAMuL,UAAe,GAAG,CAAC,CAAC;YAC1B,IAAID,aAAa,CAACf,aAAa,KAAKnH,SAAS,EAAEmI,UAAU,CAAChB,aAAa,GAAGO,cAAc,CAACQ,aAAa,CAACf,aAAa,CAAC;YACrH,IAAIe,aAAa,CAACd,iBAAiB,KAAKpH,SAAS,EAAEmI,UAAU,CAACf,iBAAiB,GAAGM,cAAc,CAACQ,aAAa,CAACd,iBAAiB,CAAC;YACjI,IAAIc,aAAa,CAACb,oBAAoB,KAAKrH,SAAS,EAAEmI,UAAU,CAACd,oBAAoB,GAAGK,cAAc,CAACQ,aAAa,CAACb,oBAAoB,CAAC;YAC1IY,MAAM,GAAG;cAAE,GAAGA,MAAM;cAAE,GAAGE;YAAW,CAAC;UACvC;QACF,CAAC,CAAC,OAAOjH,CAAC,EAAE;UACV;QAAA;QAEFvB,iBAAiB,CAACsI,MAAM,CAAC;;QAEzB;QACA,IAAI;UACF;UACA,MAAMG,4BAA4B,GAAIC,GAAW,IAAK;YACpD,IAAI,CAACA,GAAG,EAAE,OAAO,EAAE;YACnB,MAAMpF,CAAC,GAAGF,MAAM,CAACsF,GAAG,CAAC,CAAC9E,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACC,IAAI,CAAC,CAAC;YACjD;YACA,IAAI,cAAc,CAACa,IAAI,CAACpB,CAAC,CAAC,EAAE;cAC1B,OAAOA,CAAC,CAACS,KAAK,CAAC,eAAe,CAAC,CAACzB,GAAG,CAAE8C,CAAC,IAAKA,CAAC,CAACvB,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;YACtE;YACA;YACA,MAAMO,KAAK,GAAGrB,CAAC,CAACM,OAAO,CAAC,yBAAyB,EAAE,OAAO,CAAC,CAACG,KAAK,CAAC,KAAK,CAAC,CAACzB,GAAG,CAAE8C,CAAC,IAAKA,CAAC,CAACvB,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;YAC7G,IAAIO,KAAK,CAACtB,MAAM,GAAG,CAAC,EAAE,OAAOsB,KAAK;YAClC;YACA,OAAO,CAACrB,CAAC,CAAC;UACZ,CAAC;UAED,MAAMqF,YAAY,GAAGL,MAAM,CAACZ,oBAAoB,IAAI,EAAE;UACtD,IAAIkB,UAAU,GAAGH,4BAA4B,CAACE,YAAY,CAAC;UAC3D,IAAI,CAACC,UAAU,IAAIA,UAAU,CAACvF,MAAM,IAAI,CAAC,EAAE;YACzC;YACAuF,UAAU,GAAGvE,gBAAgB,CAACsE,YAAY,CAAC;UAC7C;UACA;UACA,IAAIC,UAAU,CAACvF,MAAM,KAAK,CAAC,EAAE;YAC3B,MAAMwF,IAAI,GAAGzF,MAAM,CAACwF,UAAU,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC/E,IAAI,CAAC,CAAC;YAC/C,MAAMiF,SAAS,GAAG,sIAAsI;YACxJ,MAAMC,OAAwC,GAAG,EAAE;YACnD;YACAD,SAAS,CAACE,SAAS,GAAG,CAAC;YACvB,IAAIC,EAA0B;YAC9B,OAAO,CAACA,EAAE,GAAGH,SAAS,CAACI,IAAI,CAACL,IAAI,CAAC,MAAM,IAAI,EAAE;cAAA,IAAAM,SAAA;cAC3CJ,OAAO,CAACK,IAAI,CAAC;gBAAEC,GAAG,GAAAF,SAAA,GAAEF,EAAE,CAACK,KAAK,cAAAH,SAAA,cAAAA,SAAA,GAAI,CAAC;gBAAEI,IAAI,EAAEN,EAAE,CAAC,CAAC;cAAE,CAAC,CAAC;YACnD;YACA,IAAIF,OAAO,CAAC1F,MAAM,GAAG,CAAC,EAAE;cACtB,MAAMmG,MAAgB,GAAG,EAAE;cAC3B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGV,OAAO,CAAC1F,MAAM,EAAEoG,CAAC,EAAE,EAAE;gBACvC,MAAMC,KAAK,GAAGX,OAAO,CAACU,CAAC,CAAC,CAACJ,GAAa;gBACtC,MAAMM,GAAG,GAAGF,CAAC,GAAG,CAAC,GAAGV,OAAO,CAAC1F,MAAM,GAAG0F,OAAO,CAACU,CAAC,GAAC,CAAC,CAAC,CAACJ,GAAG,GAAaR,IAAI,CAACxF,MAAM;gBAC7E,MAAMuG,KAAK,GAAGf,IAAI,CAAC5E,KAAK,CAACyF,KAAK,EAAEC,GAAG,CAAC,CAAC9F,IAAI,CAAC,CAAC;gBAC3C,IAAI+F,KAAK,EAAEJ,MAAM,CAACJ,IAAI,CAACQ,KAAK,CAAC;cAC/B;cACA,IAAIJ,MAAM,CAACnG,MAAM,GAAG,CAAC,EAAEuF,UAAU,GAAGY,MAAM;YAC5C;UACF;UAEA,MAAMK,eAAe,GAAGjB,UAAU,CAC/B3E,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CACX3B,GAAG,CAAEgB,CAAC,IAAK;YACV,MAAMK,OAAO,GAAGP,MAAM,CAACE,CAAC,CAAC,CAACM,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAACC,IAAI,CAAC,CAAC;YACxE,OAAOF,OAAO,CAACM,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC;UAC9B,CAAC,CAAC,CACDnB,MAAM,CAACsB,OAAO,CAAC;UAClBpG,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,gBAAgB,EAAE;YAAEC,MAAM,EAAE;cAAEjJ,WAAW,EAAEkN;YAAgB;UAAE,CAAC,CAAC,CAAC;QACvG,CAAC,CAAC,OAAOtI,CAAC,EAAE;UACV;QAAA;MAEJ;IACF,CAAC,CAAC,OAAOA,CAAC,EAAE;MACV8F,OAAO,CAACC,KAAK,CAAC/F,CAAC,CAAC;MAChBvB,iBAAiB,CAAC;QAChBwH,aAAa,EAAE,yBAAyB;QACxCC,iBAAiB,EAAE,EAAE;QACrBC,oBAAoB,EAAE;MACxB,CAAC,CAAC;IACJ,CAAC,SAAS;MACR5H,iBAAiB,CAAC,KAAK,CAAC;IAC1B;EACF;;EAEA;EACA,MAAM0F,YAAY,GAAGzJ,MAAM,CAAS,CAAC,CAAC;EACtC,SAAS+N,qBAAqBA,CAAC/I,QAAgB,EAAE;IAC/C;IACA,MAAMuE,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAIE,YAAY,CAACC,OAAO,IAAIH,GAAG,GAAGE,YAAY,CAACC,OAAO,GAAG,KAAK,EAAE;MAC9DzH,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;QAAEC,MAAM,EAAE;UAAEC,OAAO,EAAE,wDAAwD;UAAEC,IAAI,EAAE;QAAO;MAAE,CAAC,CAAC,CAAC;MAClJ;IACF;IACA,KAAKT,qBAAqB,CAACtE,QAAQ,CAAC;EACtC;;EAEA;EACAjF,SAAS,CAAC,MAAM;IACd,IAAI4D,gBAAgB,EAAE;MACpB2F,qBAAqB,CAAC3F,gBAAgB,CAAC;IACzC;IACA;EACF,CAAC,EAAE,CAACA,gBAAgB,CAAC,CAAC;;EAEtB;EACA,SAASqK,gBAAgBA,CAACC,OAA8C,EAAE;IAAA,IAAAC,qBAAA,EAAAC,qBAAA,EAAAC,qBAAA;IACxEjK,iBAAiB,CAAC8J,OAAO,CAAC;IAC1B,IAAIA,OAAO,KAAK,SAAS,EAAE5J,eAAe,EAAA6J,qBAAA,GAAClK,cAAc,CAACyH,aAAa,cAAAyC,qBAAA,cAAAA,qBAAA,GAAI,EAAE,CAAC;IAC9E,IAAID,OAAO,KAAK,WAAW,EAAEzJ,iBAAiB,EAAA2J,qBAAA,GAACnK,cAAc,CAAC0H,iBAAiB,cAAAyC,qBAAA,cAAAA,qBAAA,GAAI,EAAE,CAAC;IACtF,IAAIF,OAAO,KAAK,WAAW,EAAEvJ,iBAAiB,EAAA0J,qBAAA,GAACpK,cAAc,CAAC2H,oBAAoB,cAAAyC,qBAAA,cAAAA,qBAAA,GAAI,EAAE,CAAC;EAC3F;EAEA,SAASC,iBAAiBA,CAAA,EAAG;IAC3BlK,iBAAiB,CAAC,IAAI,CAAC;IACvBE,eAAe,CAACC,SAAS,CAAC;IAC1BE,iBAAiB,CAACF,SAAS,CAAC;IAC5BI,iBAAiB,CAACJ,SAAS,CAAC;EAC9B;EAEA,SAASgK,eAAeA,CAACL,OAA8C,EAAE;IACvE,MAAMjJ,QAAQ,GAAGrB,gBAAgB;IACjC,MAAMmC,IAAI,GAAG;MAAE,GAAG9B;IAAe,CAAQ;IACzC,IAAIiK,OAAO,KAAK,SAAS,EAAEnI,IAAI,CAAC2F,aAAa,GAAGrH,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAI0B,IAAI,CAAC2F,aAAa;IAClF,IAAIwC,OAAO,KAAK,WAAW,EAAEnI,IAAI,CAAC4F,iBAAiB,GAAGnH,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAIuB,IAAI,CAAC4F,iBAAiB;IAC9F,IAAIuC,OAAO,KAAK,WAAW,EAAEnI,IAAI,CAAC6F,oBAAoB,GAAGlH,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAIqB,IAAI,CAAC6F,oBAAoB;IACpG1H,iBAAiB,CAAC6B,IAAI,CAAC;IACvB;IACAL,oBAAoB,CAACT,QAAQ,EAAE;MAC7ByG,aAAa,EAAE3F,IAAI,CAAC2F,aAAa;MACjCC,iBAAiB,EAAE5F,IAAI,CAAC4F,iBAAiB;MACzCC,oBAAoB,EAAE7F,IAAI,CAAC6F;IAC7B,CAAC,CAAC;IACF;IACA,IAAI;MACF,MAAM3B,OAAO,GAAG7E,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,IAAI,IAAI;MACvD,KAAK8E,KAAK,CAAC,GAAGlI,QAAQ,eAAe,EAAE;QACrCgJ,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CE,IAAI,EAAE7F,IAAI,CAACM,SAAS,CAAC;UAAE2I,OAAO,EAAEvE,OAAO;UAAEnG,SAAS,EAAEmB,QAAQ;UAAE9D,OAAO,EAAE;YACrEuK,aAAa,EAAE3F,IAAI,CAAC2F,aAAa;YACjCC,iBAAiB,EAAE5F,IAAI,CAAC4F,iBAAiB;YACzCC,oBAAoB,EAAE7F,IAAI,CAAC6F;UAC7B;QAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOnG,CAAC,EAAE;MACV;IAAA;IAEFrB,iBAAiB,CAAC,IAAI,CAAC;EACzB;;EAEA;EACA,SAASqK,gBAAgBA,CAACP,OAA8C,EAAE;IAAA,IAAAQ,sBAAA,EAAAC,sBAAA,EAAAC,sBAAA;IACxE,MAAMC,QAAgC,GAAG;MACvClF,OAAO,EAAE,eAAe;MACxBmF,SAAS,EAAE,sBAAsB;MACjCC,SAAS,EAAE;IACb,CAAC;IACD,IAAI3D,IAAI,GAAG,EAAE;IACb,IAAI8C,OAAO,KAAK,SAAS,EAAE9C,IAAI,GAAGjH,cAAc,KAAK,SAAS,GAAIE,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAI,EAAE,IAAAqK,sBAAA,GAAKzK,cAAc,CAACyH,aAAa,cAAAgD,sBAAA,cAAAA,sBAAA,GAAI,EAAG;IAC5H,IAAIR,OAAO,KAAK,WAAW,EAAE9C,IAAI,GAAGjH,cAAc,KAAK,WAAW,GAAIK,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAI,EAAE,IAAAmK,sBAAA,GAAK1K,cAAc,CAAC0H,iBAAiB,cAAAgD,sBAAA,cAAAA,sBAAA,GAAI,EAAG;IACtI,IAAIT,OAAO,KAAK,WAAW,EAAE9C,IAAI,GAAGjH,cAAc,KAAK,WAAW,GAAIO,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAI,EAAE,IAAAkK,sBAAA,GAAK3K,cAAc,CAAC2H,oBAAoB,cAAAgD,sBAAA,cAAAA,sBAAA,GAAI,EAAG;IAEzI,MAAMlH,IAAI,GAAG,CAAC0D,IAAI,IAAI,EAAE,EAAE4D,QAAQ,CAAC,CAAC,CAACjH,IAAI,CAAC,CAAC;IAC3C,IAAI,CAACL,IAAI,EAAE;MACTxF,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;QAAEC,MAAM,EAAE;UAAEC,OAAO,EAAE,4BAA4B;UAAEC,IAAI,EAAE;QAAO;MAAE,CAAC,CAAC,CAAC;MACtH;IACF;IAEA,MAAM/D,KAAmB,GAAG;MAC1BC,QAAQ,EAAE,IAAIuD,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAC1ByF,iBAAiB,EAAE,EAAE;MACrB9I,KAAK,EAAE0I,QAAQ,CAACX,OAAO,CAAC,IAAI,SAAS;MACrC9H,OAAO,EAAEsB,IAAI;MACbwH,UAAU,EAAE,IAAIzF,IAAI,CAAC,CAAC,CAAC0F,WAAW,CAAC,CAAC;MACpCC,MAAM,EAAE;IACV,CAAC;IACD,MAAMrJ,IAAI,GAAG,CAACE,KAAK,EAAE,GAAGzD,OAAO,CAAC;IAChCsD,cAAc,CAACC,IAAI,CAAC;IACpB;IACA7D,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;MAC/CC,MAAM,EAAE;QACNC,OAAO,EAAE,WAAW9D,KAAK,CAACE,KAAK,qBAAqB;QACpD6D,IAAI,EAAE,SAAS;QACfqF,WAAW,EAAE,MAAM;QACnBC,WAAW,EAAE,kBAAkB;QAC/BC,aAAa,EAAE;UAAErJ,QAAQ,EAAED,KAAK,CAACC;QAAS;MAC5C;IACF,CAAC,CAAC,CAAC;;IAEH;IACA,IAAI;MACFrB,gBAAgB,CAAC;QAAEqB,QAAQ,EAAED,KAAK,CAACC,QAAQ;QAAEgI;MAAQ,CAAC,CAAC;MACvD,IAAIpJ,YAAY,CAAC6E,OAAO,EAAEzH,MAAM,CAACsN,YAAY,CAAC1K,YAAY,CAAC6E,OAAc,CAAC;MAC1E7E,YAAY,CAAC6E,OAAO,GAAGzH,MAAM,CAACuN,UAAU,CAAC,MAAM;QAC7C5K,gBAAgB,CAAC,IAAI,CAAC;QACtBC,YAAY,CAAC6E,OAAO,GAAG,IAAI;MAC7B,CAAC,EAAE,IAAI,CAAsB;IAC/B,CAAC,CAAC,OAAOlE,CAAC,EAAE;MACV;IAAA;EAEJ;;EAEA;EACA,SAASiK,aAAaA,CAACpJ,OAAgB,EAAE;IACvC,MAAMqJ,EAAE,GAAGrJ,OAAO,KAAI1B,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEsB,QAAQ;IAC7C,IAAI,CAACyJ,EAAE,EAAE;IACTlN,UAAU,CAAEmN,IAAI,IAAK;MACnB,MAAM7J,IAAI,GAAG6J,IAAI,CAAC5I,MAAM,CAAE8B,CAAC,IAAKA,CAAC,CAAC5C,QAAQ,KAAKyJ,EAAE,CAAC;MAClD,IAAI;QAAEvK,YAAY,CAACQ,OAAO,CAAC,oBAAoB,EAAEL,IAAI,CAACM,SAAS,CAACE,IAAI,CAAC,CAAC;MAAE,CAAC,CAAC,OAAO8J,GAAG,EAAE,CAAC;MACvF,OAAO9J,IAAI;IACb,CAAC,CAAC;IACFlB,gBAAgB,CAAC,IAAI,CAAC;IACtB,IAAIC,YAAY,CAAC6E,OAAO,EAAE;MACxBzH,MAAM,CAACsN,YAAY,CAAC1K,YAAY,CAAC6E,OAAc,CAAC;MAChD7E,YAAY,CAAC6E,OAAO,GAAG,IAAI;IAC7B;IACAzH,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;MAAEC,MAAM,EAAE;QAAEC,OAAO,EAAE,gBAAgB;QAAEC,IAAI,EAAE;MAAO;IAAE,CAAC,CAAC,CAAC;EAC5G;;EAEA;EACAhK,SAAS,CAAC,MAAM;IACd,SAAS8P,UAAUA,CAACrK,CAAM,EAAE;MAAA,IAAAsK,SAAA;MAC1B,MAAMJ,EAAE,IAAAI,SAAA,GAAGtK,CAAC,CAACqE,MAAM,cAAAiG,SAAA,uBAARA,SAAA,CAAU7J,QAAQ;MAC7B,IAAI,CAACyJ,EAAE,EAAE;MACTlN,UAAU,CAAEmN,IAAI,IAAK;QACnB,MAAM7J,IAAI,GAAG6J,IAAI,CAAC5I,MAAM,CAAE8B,CAAC,IAAKA,CAAC,CAAC5C,QAAQ,KAAKyJ,EAAE,CAAC;QAClD,IAAI;UAAEvK,YAAY,CAACQ,OAAO,CAAC,oBAAoB,EAAEL,IAAI,CAACM,SAAS,CAACE,IAAI,CAAC,CAAC;QAAE,CAAC,CAAC,OAAO8J,GAAG,EAAE,CAAC;QACvF,OAAO9J,IAAI;MACb,CAAC,CAAC;MACF;MACA7D,MAAM,CAAC0H,aAAa,CAAC,IAAIC,WAAW,CAAC,UAAU,EAAE;QAAEC,MAAM,EAAE;UAAEC,OAAO,EAAE,gBAAgB;UAAEC,IAAI,EAAE;QAAO;MAAE,CAAC,CAAC,CAAC;IAC5G;IACA9H,MAAM,CAAC8N,gBAAgB,CAAC,kBAAkB,EAAEF,UAA2B,CAAC;IACxE,OAAO,MAAM5N,MAAM,CAAC+N,mBAAmB,CAAC,kBAAkB,EAAEH,UAA2B,CAAC;EAC1F,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMI,cAAc,GAAItD,GAAmB,IAAK;IAC9C,IAAI,CAACA,GAAG,EAAE,oBAAOtM,OAAA;MAAM6P,SAAS,EAAC,OAAO;MAAAC,QAAA,EAAC;IAAC;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC;IACjD;IACA,MAAMhI,UAAU,GAAGlB,MAAM,CAACsF,GAAG,CAAC,CAAC9E,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAACC,IAAI,CAAC,CAAC;IAC5D,IAAI,CAACS,UAAU,EAAE,oBAAOlI,OAAA;MAAM6P,SAAS,EAAC,OAAO;MAAAC,QAAA,EAAC;IAAC;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC;IAExD,MAAM/H,KAAK,GAAGD,UAAU,CAACP,KAAK,CAAC,KAAK,CAAC,CAACzB,GAAG,CAAEgB,CAAC,IAAKA,CAAC,CAACO,IAAI,CAAC,CAAC,CAAC,CAACf,MAAM,CAACsB,OAAO,CAAC;;IAE1E;IACA,MAAMmI,UAAU,GAAGhI,KAAK,CAACiI,KAAK,CAAEhI,CAAC,IAAK,WAAW,CAACE,IAAI,CAACF,CAAC,CAAC,CAAC;IAC1D,IAAI+H,UAAU,EAAE;MACd,oBAAOnQ,OAAA;QAAA8P,QAAA,EAAK3H,KAAK,CAACjC,GAAG,CAAC,CAACkC,CAAC,EAAEiF,CAAC,kBAAKrN,OAAA;UAAA8P,QAAA,EAAa1H,CAAC,CAACZ,OAAO,CAAC,WAAW,EAAE,EAAE;QAAC,GAA9B6F,CAAC;UAAA0C,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAkC,CAAC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IACtF;;IAEA;IACA,MAAMG,UAAU,GAAGlI,KAAK,CAACiI,KAAK,CAAEhI,CAAC,IAAK,QAAQ,CAACE,IAAI,CAACF,CAAC,CAAC,CAAC;IACvD,IAAIiI,UAAU,EAAE;MACd,oBAAOrQ,OAAA;QAAA8P,QAAA,EAAK3H,KAAK,CAACjC,GAAG,CAAC,CAACkC,CAAC,EAAEiF,CAAC,kBAAKrN,OAAA;UAAA8P,QAAA,EAAa1H,CAAC,CAACZ,OAAO,CAAC,WAAW,EAAE,EAAE;QAAC,GAA9B6F,CAAC;UAAA0C,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAkC,CAAC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IACtF;;IAEA;IACA,IAAI/H,KAAK,CAAClB,MAAM,GAAG,CAAC,EAAE;MACpB,oBAAOjH,OAAA;QAAA8P,QAAA,EAAM3H,KAAK,CAACjC,GAAG,CAAC,CAACsC,CAAC,EAAE6E,CAAC,kBAAKrN,OAAA;UAAWsQ,KAAK,EAAE;YAAEC,SAAS,EAAElD,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG;UAAE,CAAE;UAAAyC,QAAA,EAAEtH;QAAC,GAA5C6E,CAAC;UAAA0C,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAA+C,CAAC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC;IACpG;;IAEA;IACA,oBAAOlQ,OAAA;MAAA8P,QAAA,EAAM5H;IAAU;MAAA6H,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC;EAChC,CAAC;EAED,oBACElQ,OAAA;IAAO6P,SAAS,EAAC,aAAa;IAACS,KAAK,EAAE;MAAEE,SAAS,EAAE,oBAAoB;MAAEC,QAAQ,EAAE;IAAO,CAAE;IAAAX,QAAA,gBAC1F9P,OAAA;MAAS6P,SAAS,EAAC,sBAAsB;MAAAC,QAAA,eACvC9P,OAAA;QAAK6P,SAAS,EAAC,yBAAyB;QAAAC,QAAA,gBACtC9P,OAAA;UAAK6P,SAAS,EAAC,oBAAoB;UAAAC,QAAA,gBACjC9P,OAAA;YAAA8P,QAAA,eACE9P,OAAA;cAAA8P,QAAA,eACE9P,OAAA;gBACE6P,SAAS,EAAC,gBAAgB;gBAC1Ba,OAAO,EAAEA,CAAA,KAAMhD,qBAAqB,CAACpK,gBAAgB,CAAE;gBACvDqN,QAAQ,EAAElN,cAAe;gBACzB,cAAW,mBAAmB;gBAAAqM,QAAA,EAE7BrM,cAAc,gBAAGzD,OAAA;kBAAM6P,SAAS,EAAC,YAAY;kBAAC;gBAAW;kBAAAE,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC,GAAG;cAAmB;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC7E;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACN;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAEH,CAAC,eAENlQ,OAAA;YAAK6P,SAAS,EAAC,gBAAgB;YAACS,KAAK,EAAE;cAAEM,OAAO,EAAE,MAAM;cAAEC,GAAG,EAAE,CAAC;cAAEC,UAAU,EAAE;YAAS,CAAE;YAAAhB,QAAA,gBACvF9P,OAAA;cAAK6P,SAAS,EAAC,gBAAgB;cAAC,mBAAW;cAAAC,QAAA,eAEzC9P,OAAA;gBAAK+Q,KAAK,EAAC,IAAI;gBAACC,MAAM,EAAC,IAAI;gBAACC,OAAO,EAAC,WAAW;gBAACC,IAAI,EAAC,MAAM;gBAACC,KAAK,EAAC,4BAA4B;gBAAArB,QAAA,gBAC5F9P,OAAA;kBAAMoR,CAAC,EAAC,aAAa;kBAACC,MAAM,EAAC,uBAAuB;kBAACC,WAAW,EAAC,KAAK;kBAACC,aAAa,EAAC,OAAO;kBAACC,cAAc,EAAC;gBAAO;kBAAAzB,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC,eACtHlQ,OAAA;kBAAQyR,EAAE,EAAC,IAAI;kBAACC,EAAE,EAAC,IAAI;kBAACC,CAAC,EAAC,GAAG;kBAACN,MAAM,EAAC,uBAAuB;kBAACC,WAAW,EAAC;gBAAK;kBAAAvB,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC9E;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eAENlQ,OAAA;cAAKsQ,KAAK,EAAE;gBAAEM,OAAO,EAAE,MAAM;gBAAEC,GAAG,EAAE,CAAC;gBAAEC,UAAU,EAAE;cAAS,CAAE;cAAAhB,QAAA,EAC3D/O,OAAO,CAACkG,MAAM,GAAG,CAAC,gBACjBjH,OAAA;gBACE4R,KAAK,EAAEtO,gBAAiB;gBACxBuO,QAAQ,EAAG1M,CAAC,IAAK5B,mBAAmB,CAAC4B,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;gBACrD/B,SAAS,EAAC,iBAAiB;gBAAAC,QAAA,EAE1B/O,OAAO,CAACmF,GAAG,CAAE8C,CAAC,iBACbhJ,OAAA;kBAA0B4R,KAAK,EAAE5I,CAAC,CAACxF,SAAU;kBAAAsM,QAAA,EAC1C9G,CAAC,CAACnD;gBAAK,GADGmD,CAAC,CAACxF,SAAS;kBAAAuM,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAEhB,CACT;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACI,CAAC,GACP;YAAI;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACL,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAENlQ,OAAA;UAAK6P,SAAS,EAAC,WAAW;UAAAC,QAAA,gBAGxB9P,OAAA;YAAK6P,SAAS,EAAC,uCAAuC;YAAAC,QAAA,gBACpD9P,OAAA;cAAKsQ,KAAK,EAAE;gBAAEM,OAAO,EAAE,MAAM;gBAAEmB,cAAc,EAAE,eAAe;gBAAEjB,UAAU,EAAE;cAAS,CAAE;cAAAhB,QAAA,gBACrF9P,OAAA;gBAAKsQ,KAAK,EAAE;kBAAE0B,UAAU,EAAE;gBAAI,CAAE;gBAAAlC,QAAA,EAAC;cAAa;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAK,CAAC,eACpDlQ,OAAA;gBAAKsQ,KAAK,EAAE;kBAAEM,OAAO,EAAE,MAAM;kBAAEC,GAAG,EAAE,CAAC;kBAAEC,UAAU,EAAE;gBAAS,CAAE;gBAAAhB,QAAA,EAC3DjM,cAAc,KAAK,SAAS,gBAC3B7D,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAMzC,eAAe,CAAC,SAAS,CAAE;oBAAA6B,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,eACvFlQ,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAE1C,iBAAkB;oBAAA8B,QAAA,EAAC;kBAAM;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC;gBAAA,eAC1E,CAAC,gBAEHlQ,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAM/C,gBAAgB,CAAC,SAAS,CAAE;oBAAC,cAAW,MAAM;oBAAAmC,QAAA,EAAC;kBAAE;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,EACvG,CAAA5L,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEsJ,OAAO,MAAK,SAAS,IAAItJ,aAAa,CAACsB,QAAQ,gBAC7D5F,OAAA;oBAAQ6P,SAAS,EAAC,qBAAqB;oBAACa,OAAO,EAAEA,CAAA,KAAMtB,aAAa,CAAC9K,aAAa,CAACsB,QAAQ,CAAE;oBAAAkK,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,gBAE3GlQ,OAAA;oBAAQ6P,SAAS,EAAC,oBAAoB;oBAACa,OAAO,EAAEA,CAAA,KAAMvC,gBAAgB,CAAC,SAAS,CAAE;oBAAC,cAAW,gBAAgB;oBAAA2B,QAAA,eAC5G9P,OAAA;sBAAK+Q,KAAK,EAAC,IAAI;sBAACC,MAAM,EAAC,IAAI;sBAACC,OAAO,EAAC,WAAW;sBAACC,IAAI,EAAC,MAAM;sBAACC,KAAK,EAAC,4BAA4B;sBAAC,mBAAW;sBAAArB,QAAA,eACxG9P,OAAA;wBAAMoR,CAAC,EAAC,kBAAkB;wBAACC,MAAM,EAAC,cAAc;wBAACC,WAAW,EAAC,GAAG;wBAACC,aAAa,EAAC,OAAO;wBAACC,cAAc,EAAC;sBAAO;wBAAAzB,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAE;oBAAC;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAC7G;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACA,CACT;gBAAA,eACD;cACH;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACE,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eACNlQ,OAAA;cAAK6P,SAAS,EAAC,cAAc;cAACS,KAAK,EAAE;gBAAE2B,QAAQ,EAAE,EAAE;gBAAEC,UAAU,EAAE,GAAG;gBAAE3B,SAAS,EAAE;cAAE,CAAE;cAAAT,QAAA,EAClFjM,cAAc,KAAK,SAAS,gBAC3B7D,OAAA;gBAAU4R,KAAK,EAAE7N,YAAY,aAAZA,YAAY,cAAZA,YAAY,GAAI,EAAG;gBAAC8N,QAAQ,EAAG1M,CAAC,IAAKnB,eAAe,CAACmB,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;gBAACtB,KAAK,EAAE;kBAAES,KAAK,EAAE,MAAM;kBAAEoB,SAAS,EAAE;gBAAI;cAAE;gBAAApC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,GAEnIN,cAAc,EAAAxO,IAAA,IAAAC,KAAA,IAAAC,sBAAA,GAACqC,cAAc,CAACyH,aAAa,cAAA9J,sBAAA,cAAAA,sBAAA,GAAKR,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAUsK,aAAa,cAAA/J,KAAA,cAAAA,KAAA,GAAKP,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAUsR,YAAY,cAAAhR,IAAA,cAAAA,IAAA,GAAI,4CAA4C;YACzK;cAAA2O,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC,eAGNlQ,OAAA;YAAK6P,SAAS,EAAC,wBAAwB;YAAAC,QAAA,gBACrC9P,OAAA;cAAKsQ,KAAK,EAAE;gBAAEM,OAAO,EAAE,MAAM;gBAAEmB,cAAc,EAAE,eAAe;gBAAEjB,UAAU,EAAE;cAAS,CAAE;cAAAhB,QAAA,gBACrF9P,OAAA;gBAAIsQ,KAAK,EAAE;kBAAE+B,MAAM,EAAE;gBAAE,CAAE;gBAAAvC,QAAA,EAAC;cAAoB;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAAC,eACnDlQ,OAAA;gBAAKsQ,KAAK,EAAE;kBAAEM,OAAO,EAAE,MAAM;kBAAEC,GAAG,EAAE,CAAC;kBAAEC,UAAU,EAAE;gBAAS,CAAE;gBAAAhB,QAAA,EAC3DjM,cAAc,KAAK,WAAW,gBAC7B7D,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAMzC,eAAe,CAAC,WAAW,CAAE;oBAAA6B,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,eACzFlQ,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAE1C,iBAAkB;oBAAA8B,QAAA,EAAC;kBAAM;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC;gBAAA,eAC1E,CAAC,gBAEHlQ,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAM/C,gBAAgB,CAAC,WAAW,CAAE;oBAAC,cAAW,MAAM;oBAAAmC,QAAA,EAAC;kBAAE;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,EACzG,CAAA5L,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEsJ,OAAO,MAAK,WAAW,IAAItJ,aAAa,CAACsB,QAAQ,gBAC/D5F,OAAA;oBAAQ6P,SAAS,EAAC,qBAAqB;oBAACa,OAAO,EAAEA,CAAA,KAAMtB,aAAa,CAAC9K,aAAa,CAACsB,QAAQ,CAAE;oBAAAkK,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,gBAE3GlQ,OAAA;oBAAQ6P,SAAS,EAAC,oBAAoB;oBAACa,OAAO,EAAEA,CAAA,KAAMvC,gBAAgB,CAAC,WAAW,CAAE;oBAAC,cAAW,gBAAgB;oBAAA2B,QAAA,eAC9G9P,OAAA;sBAAK+Q,KAAK,EAAC,IAAI;sBAACC,MAAM,EAAC,IAAI;sBAACC,OAAO,EAAC,WAAW;sBAACC,IAAI,EAAC,MAAM;sBAACC,KAAK,EAAC,4BAA4B;sBAAC,mBAAW;sBAAArB,QAAA,eACxG9P,OAAA;wBAAMoR,CAAC,EAAC,kBAAkB;wBAACC,MAAM,EAAC,cAAc;wBAACC,WAAW,EAAC,GAAG;wBAACC,aAAa,EAAC,OAAO;wBAACC,cAAc,EAAC;sBAAO;wBAAAzB,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAE;oBAAC;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAC7G;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACA,CACT;gBAAA,eACD;cACH;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACE,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eACNlQ,OAAA;cAAK6P,SAAS,EAAC,cAAc;cAACS,KAAK,EAAE;gBAAE2B,QAAQ,EAAE,EAAE;gBAAEC,UAAU,EAAE,GAAG;gBAAE3B,SAAS,EAAE;cAAE,CAAE;cAAAT,QAAA,EAClFjM,cAAc,KAAK,WAAW,gBAC7B7D,OAAA;gBAAU4R,KAAK,EAAE1N,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAI,EAAG;gBAAC2N,QAAQ,EAAG1M,CAAC,IAAKhB,iBAAiB,CAACgB,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;gBAACtB,KAAK,EAAE;kBAAES,KAAK,EAAE,MAAM;kBAAEoB,SAAS,EAAE;gBAAI;cAAE;gBAAApC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,GAEvIN,cAAc,EAAArO,sBAAA,GAACoC,cAAc,CAAC0H,iBAAiB,cAAA9J,sBAAA,cAAAA,sBAAA,GAAKT,WAAW,KAAAU,qBAAA,GAAIV,WAAW,CAACwR,UAAU,cAAA9Q,qBAAA,eAAtBA,qBAAA,CAAwByF,MAAM,GAAGnG,WAAW,CAACwR,UAAU,CAACxK,IAAI,CAAC,IAAI,CAAC,GAAG,GAAI;YAC7I;cAAAiI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC,eAENlQ,OAAA;YAAK6P,SAAS,EAAC,0BAA0B;YAAAC,QAAA,gBACvC9P,OAAA;cAAKsQ,KAAK,EAAE;gBAAEM,OAAO,EAAE,MAAM;gBAAEmB,cAAc,EAAE,eAAe;gBAAEjB,UAAU,EAAE;cAAS,CAAE;cAAAhB,QAAA,gBACrF9P,OAAA;gBAAIsQ,KAAK,EAAE;kBAAE+B,MAAM,EAAE;gBAAE,CAAE;gBAAAvC,QAAA,EAAC;cAAoB;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAAC,eACnDlQ,OAAA;gBAAKsQ,KAAK,EAAE;kBAAEM,OAAO,EAAE,MAAM;kBAAEC,GAAG,EAAE,CAAC;kBAAEC,UAAU,EAAE;gBAAS,CAAE;gBAAAhB,QAAA,EAC3DjM,cAAc,KAAK,WAAW,gBAC7B7D,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAMzC,eAAe,CAAC,WAAW,CAAE;oBAAA6B,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,eACzFlQ,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAE1C,iBAAkB;oBAAA8B,QAAA,EAAC;kBAAM;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC;gBAAA,eAC1E,CAAC,gBAEHlQ,OAAA,CAAAE,SAAA;kBAAA4P,QAAA,gBACE9P,OAAA;oBAAQ6P,SAAS,EAAC,YAAY;oBAACa,OAAO,EAAEA,CAAA,KAAM/C,gBAAgB,CAAC,WAAW,CAAE;oBAAC,cAAW,MAAM;oBAAAmC,QAAA,EAAC;kBAAE;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,EACzG,CAAA5L,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEsJ,OAAO,MAAK,WAAW,IAAItJ,aAAa,CAACsB,QAAQ,gBAC/D5F,OAAA;oBAAQ6P,SAAS,EAAC,qBAAqB;oBAACa,OAAO,EAAEA,CAAA,KAAMtB,aAAa,CAAC9K,aAAa,CAACsB,QAAQ,CAAE;oBAAAkK,QAAA,EAAC;kBAAI;oBAAAC,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAQ,CAAC,gBAE3GlQ,OAAA;oBAAQ6P,SAAS,EAAC,oBAAoB;oBAACa,OAAO,EAAEA,CAAA,KAAMvC,gBAAgB,CAAC,WAAW,CAAE;oBAAC,cAAW,gBAAgB;oBAAA2B,QAAA,eAC9G9P,OAAA;sBAAK+Q,KAAK,EAAC,IAAI;sBAACC,MAAM,EAAC,IAAI;sBAACC,OAAO,EAAC,WAAW;sBAACC,IAAI,EAAC,MAAM;sBAACC,KAAK,EAAC,4BAA4B;sBAAC,mBAAW;sBAAArB,QAAA,eACxG9P,OAAA;wBAAMoR,CAAC,EAAC,kBAAkB;wBAACC,MAAM,EAAC,cAAc;wBAACC,WAAW,EAAC,GAAG;wBAACC,aAAa,EAAC,OAAO;wBAACC,cAAc,EAAC;sBAAO;wBAAAzB,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAE;oBAAC;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAC7G;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACA,CACT;gBAAA,eACD;cACH;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACE,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eACNlQ,OAAA;cAAK6P,SAAS,EAAC,cAAc;cAACS,KAAK,EAAE;gBAAE2B,QAAQ,EAAE,EAAE;gBAAEC,UAAU,EAAE,GAAG;gBAAE3B,SAAS,EAAE;cAAE,CAAE;cAAAT,QAAA,EAClFjM,cAAc,KAAK,WAAW,gBAC7B7D,OAAA;gBAAU4R,KAAK,EAAExN,cAAc,aAAdA,cAAc,cAAdA,cAAc,GAAI,EAAG;gBAACyN,QAAQ,EAAG1M,CAAC,IAAKd,iBAAiB,CAACc,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;gBAACtB,KAAK,EAAE;kBAAES,KAAK,EAAE,MAAM;kBAAEoB,SAAS,EAAE;gBAAI;cAAE;gBAAApC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,GAEvIN,cAAc,EAAAnO,sBAAA,GAACkC,cAAc,CAAC2H,oBAAoB,cAAA7J,sBAAA,cAAAA,sBAAA,GAAI,GAAG;YAC1D;cAAAsO,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAGE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAGVlQ,OAAA;MAAS6P,SAAS,EAAC,sBAAsB;MAAAC,QAAA,eACvC9P,OAAA;QACE6P,SAAS,EAAC,cAAc;QACxBvF,IAAI,EAAC,QAAQ;QACboG,OAAO,EAAEA,CAAA,KAAMzO,WAAW,CAAC,IAAI,CAAE;QACjC,gBAAcD,QAAS;QACvBuQ,QAAQ,EAAE,CAAE;QACZC,SAAS,EAAGrN,CAAC,IAAK;UAChB,IAAIA,CAAC,CAACP,GAAG,KAAK,OAAO,IAAIO,CAAC,CAACP,GAAG,KAAK,GAAG,EAAE3C,WAAW,CAAC,IAAI,CAAC;QAC3D,CAAE;QAAA6N,QAAA,gBAEF9P,OAAA;UAAK6P,SAAS,EAAC,kBAAkB;UAAC,mBAAW;UAAAC,QAAA,EAAC;QAE9C;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,eACNlQ,OAAA;UAAK6P,SAAS,EAAC,eAAe;UAAAC,QAAA,EAAC;QAAY;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9C;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,EAETlO,QAAQ,IAAI,OAAOyQ,QAAQ,KAAK,WAAW,IAAIA,QAAQ,CAAC3H,IAAI,gBACzDlL,YAAY,cACVI,OAAA;MAAK6P,SAAS,EAAC,gBAAgB;MAACvF,IAAI,EAAC,QAAQ;MAAC,cAAW,MAAM;MAACoG,OAAO,EAAEA,CAAA,KAAMzO,WAAW,CAAC,KAAK,CAAE;MAAA6N,QAAA,eAChG9P,OAAA;QACE6P,SAAS,EAAE,oBAAqB;QAChCS,KAAK,EAAE;UAAES,KAAK,EAAE,GAAGzO,UAAU;QAAK,CAAE;QACpCoO,OAAO,EAAGvL,CAAC,IAAKA,CAAC,CAACuN,eAAe,CAAC,CAAE;QAAA5C,QAAA,gBAEpC9P,OAAA;UAAK6P,SAAS,EAAC,cAAc;UAAAC,QAAA,gBAC3B9P,OAAA;YAAA8P,QAAA,EAAI;UAAY;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACrBlQ,OAAA;YAAKsQ,KAAK,EAAE;cAAEM,OAAO,EAAE,MAAM;cAAEC,GAAG,EAAE,EAAE;cAAEC,UAAU,EAAE;YAAS,CAAE;YAAAhB,QAAA,gBAC7D9P,OAAA;cAAO6P,SAAS,EAAC,OAAO;cAACS,KAAK,EAAE;gBAAE2B,QAAQ,EAAE;cAAU,CAAE;cAAAnC,QAAA,EAAC;YAAK;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eACtElQ,OAAA;cACE2S,IAAI,EAAC,OAAO;cACZC,GAAG,EAAE,EAAG;cACRC,GAAG,EAAE,EAAG;cACRjB,KAAK,EAAEtP,UAAW;cAClBuP,QAAQ,EAAG1M,CAAC,IAAK5C,aAAa,CAACuE,MAAM,CAAC3B,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAC;YAAE;cAAA7B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACxD,CAAC,eACFlQ,OAAA;cAAO6P,SAAS,EAAC,OAAO;cAACS,KAAK,EAAE;gBAAE2B,QAAQ,EAAE;cAAU,CAAE;cAAAnC,QAAA,EAAC;YAAI;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eACrElQ,OAAA;cAAQ6P,SAAS,EAAC,aAAa;cAAC+B,KAAK,EAAE9O,UAAW;cAAC+O,QAAQ,EAAG1M,CAAC,IAAKpC,aAAa,CAACoC,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;cAAC,cAAW,qBAAqB;cAAA9B,QAAA,gBACjI9P,OAAA;gBAAQ4R,KAAK,EAAC,cAAc;gBAAA9B,QAAA,EAAC;cAAY;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eAClDlQ,OAAA;gBAAQ4R,KAAK,EAAC,cAAc;gBAAA9B,QAAA,EAAC;cAAY;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,eAClDlQ,OAAA;gBAAQ4R,KAAK,EAAC,QAAQ;gBAAA9B,QAAA,EAAC;cAAM;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAChC,CAAC,eACTlQ,OAAA;cAAQ6P,SAAS,EAAC,YAAY;cAACa,OAAO,EAAEA,CAAA,KAAMzO,WAAW,CAAC,KAAK,CAAE;cAAA6N,QAAA,EAAC;YAAK;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC7E,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAENlQ,OAAA;UAAK6P,SAAS,EAAC,YAAY;UAACS,KAAK,EAAE;YAAEQ,UAAU,EAAE;UAAU,CAAE;UAAAhB,QAAA,gBAC3D9P,OAAA;YAAK6P,SAAS,EAAC,cAAc;YAACS,KAAK,EAAE;cAAES,KAAK,EAAE;YAAQ,CAAE;YAAAjB,QAAA,gBACtD9P,OAAA;cAAK6P,SAAS,EAAC,2BAA2B;cAAAC,QAAA,EAAC;YAAO;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK,CAAC,eACxDlQ,OAAA;cAAA8P,QAAA,EACG5N,OAAO,CAACgE,GAAG,CAAEf,CAAC,iBACbnF,OAAA;gBAAqB6P,SAAS,EAAE,qBAAqB,CAAAzN,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEwD,QAAQ,MAAKT,CAAC,CAACS,QAAQ,GAAG,QAAQ,GAAG,EAAE,EAAG;gBAAC8K,OAAO,EAAEA,CAAA,KAAMrO,gBAAgB,CAAC8C,CAAC,CAAE;gBAAA2K,QAAA,gBAChJ9P,OAAA;kBAAK6P,SAAS,EAAC,UAAU;kBAAAC,QAAA,EAAE3K,CAAC,CAACU;gBAAK;kBAAAkK,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC,eACzClQ,OAAA;kBAAK6P,SAAS,EAAC,eAAe;kBAAAC,QAAA,EAAE,IAAI3G,IAAI,CAAChE,CAAC,CAACyJ,UAAU,CAAC,CAACkE,kBAAkB,CAAC;gBAAC;kBAAA/C,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC;cAAA,GAF3E/K,CAAC,CAACS,QAAQ;gBAAAmK,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAGf,CACL;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACA,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACF,CAAC,eAENlQ,OAAA;YAAK6P,SAAS,EAAC,eAAe;YAACS,KAAK,EAAE;cAAEyC,IAAI,EAAE;YAAE,CAAE;YAAAjD,QAAA,gBAChD9P,OAAA;cAAK6P,SAAS,EAAC,iBAAiB;cAACS,KAAK,EAAE;gBAAEM,OAAO,EAAE,MAAM;gBAAEoC,aAAa,EAAE,QAAQ;gBAAEnC,GAAG,EAAE;cAAE,CAAE;cAAAf,QAAA,gBAC3F9P,OAAA;gBAAKsQ,KAAK,EAAE;kBAAEM,OAAO,EAAE,MAAM;kBAAEmB,cAAc,EAAE,eAAe;kBAAEjB,UAAU,EAAE;gBAAS,CAAE;gBAAAhB,QAAA,gBACrF9P,OAAA;kBAAIsQ,KAAK,EAAE;oBAAE+B,MAAM,EAAE;kBAAE,CAAE;kBAAAvC,QAAA,EAAC;gBAAS;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAI,CAAC,eACxClQ,OAAA;kBAAQ6P,SAAS,EAAC,YAAY;kBAACa,OAAO,EAAEA,CAAA,KAAM;oBAAEjO,cAAc,CAAEyE,CAAC,IAAK,CAACA,CAAC,CAAC;oBAAEvE,WAAW,CAAC,EAAE,CAAC;oBAAEE,aAAa,CAAC,EAAE,CAAC;kBAAE,CAAE;kBAAAiN,QAAA,EAC9GtN,WAAW,GAAG,QAAQ,GAAG;gBAAK;kBAAAuN,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACzB,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACN,CAAC,EAEL1N,WAAW,iBACVxC,OAAA;gBAAKsQ,KAAK,EAAE;kBAAEM,OAAO,EAAE,MAAM;kBAAEC,GAAG,EAAE;gBAAG,CAAE;gBAAAf,QAAA,gBACvC9P,OAAA;kBAAKsQ,KAAK,EAAE;oBAAES,KAAK,EAAE;kBAAI,CAAE;kBAAAjB,QAAA,eACzB9P,OAAA;oBAAO6P,SAAS,EAAC,2BAA2B;oBAACoD,WAAW,EAAC,OAAO;oBAACrB,KAAK,EAAElP,QAAS;oBAACmP,QAAQ,EAAG1M,CAAC,IAAKxC,WAAW,CAACwC,CAAC,CAAC2M,MAAM,CAACF,KAAK;kBAAE;oBAAA7B,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAE;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAC/H,CAAC,eACNlQ,OAAA;kBAAKsQ,KAAK,EAAE;oBAAEyC,IAAI,EAAE;kBAAE,CAAE;kBAAAjD,QAAA,gBACtB9P,OAAA;oBAAU6P,SAAS,EAAC,kBAAkB;oBAACoD,WAAW,EAAC,qBAAqB;oBAACrB,KAAK,EAAEhP,UAAW;oBAACiP,QAAQ,EAAG1M,CAAC,IAAKtC,aAAa,CAACsC,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;oBAACtB,KAAK,EAAE;sBAAE4C,UAAU,EAAEpQ;oBAAW;kBAAE;oBAAAiN,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAE,CAAC,eACjLlQ,OAAA;oBAAKsQ,KAAK,EAAE;sBAAEM,OAAO,EAAE,MAAM;sBAAEC,GAAG,EAAE,CAAC;sBAAEN,SAAS,EAAE;oBAAE,CAAE;oBAAAT,QAAA,eACpD9P,OAAA;sBAAQ6P,SAAS,EAAC,YAAY;sBAACa,OAAO,EAAEA,CAAA,KAAM;wBAC5C,MAAM1H,CAAC,GAAGtG,QAAQ;wBAClB,MAAMyQ,CAAC,GAAGvQ,UAAU;wBACpB,IAAI,CAACoG,CAAC,CAACvB,IAAI,CAAC,CAAC,IAAI,CAAC0L,CAAC,CAAC1L,IAAI,CAAC,CAAC,EAAE;wBAC5B,MAAM9B,KAAmB,GAAG;0BAAEC,QAAQ,EAAE,IAAIuD,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;0BAAEyF,iBAAiB,EAAE,EAAE;0BAAE9I,KAAK,EAAEmD,CAAC,CAACvB,IAAI,CAAC,CAAC,IAAI,UAAU;0BAAE3B,OAAO,EAAEqN,CAAC,CAAC1L,IAAI,CAAC,CAAC;0BAAEmH,UAAU,EAAE,IAAIzF,IAAI,CAAC,CAAC,CAAC0F,WAAW,CAAC,CAAC;0BAAEC,MAAM,EAAE;wBAAe,CAAC;wBACjM,MAAMrJ,IAAI,GAAG,CAACE,KAAK,EAAE,GAAGzD,OAAO,CAAC;wBAChCsD,cAAc,CAACC,IAAI,CAAC;wBACpBpD,gBAAgB,CAACsD,KAAK,CAAC;wBACvBlD,cAAc,CAAC,KAAK,CAAC;wBACrBE,WAAW,CAAC,EAAE,CAAC;wBACfE,aAAa,CAAC,EAAE,CAAC;sBACnB,CAAE;sBAAAiN,QAAA,EAAC;oBAAU;sBAAAC,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAQ;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACnB,CAAC;gBAAA;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACH,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACH,CACN;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC,eAENlQ,OAAA;cAAK6P,SAAS,EAAC,iBAAiB;cAACS,KAAK,EAAE;gBAAEC,SAAS,EAAE;cAAG,CAAE;cAAAT,QAAA,EACvD1N,aAAa,GACZY,cAAc,KAAKZ,aAAa,CAACwD,QAAQ,gBACvC5F,OAAA;gBAAK6P,SAAS,EAAC,eAAe;gBAAAC,QAAA,gBAC5B9P,OAAA;kBAAK6P,SAAS,EAAC,WAAW;kBAAAC,QAAA,gBACxB9P,OAAA;oBAAKsQ,KAAK,EAAE;sBAAEM,OAAO,EAAE,MAAM;sBAAEC,GAAG,EAAE,EAAE;sBAAEC,UAAU,EAAE;oBAAS,CAAE;oBAAAhB,QAAA,gBAC7D9P,OAAA;sBAAO6P,SAAS,EAAC,2BAA2B;sBAAC+B,KAAK,EAAE1O,SAAU;sBAAC2O,QAAQ,EAAG1M,CAAC,IAAKhC,YAAY,CAACgC,CAAC,CAAC2M,MAAM,CAACF,KAAK;oBAAE;sBAAA7B,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAE,CAAC,eAChHlQ,OAAA;sBAAKsQ,KAAK,EAAE;wBAAE8C,UAAU,EAAE,MAAM;wBAAExC,OAAO,EAAE,MAAM;wBAAEC,GAAG,EAAE;sBAAE,CAAE;sBAAAf,QAAA,gBAC1D9P,OAAA;wBAAQ6P,SAAS,EAAC,YAAY;wBAACa,OAAO,EAAEA,CAAA,KAAM3K,QAAQ,CAAC3D,aAAa,CAACwD,QAAQ,CAAE;wBAAAkK,QAAA,EAAC;sBAAI;wBAAAC,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC,eAC7FlQ,OAAA;wBAAQ6P,SAAS,EAAC,YAAY;wBAACa,OAAO,EAAEnK,UAAW;wBAAAuJ,QAAA,EAAC;sBAAM;wBAAAC,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC;oBAAA;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAChE,CAAC;kBAAA;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACH,CAAC,eACNlQ,OAAA;oBAAK6P,SAAS,EAAC,OAAO;oBAAAC,QAAA,EAAE,IAAI3G,IAAI,CAAC/G,aAAa,CAACwM,UAAU,CAAC,CAACyE,cAAc,CAAC;kBAAC;oBAAAtD,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAM,CAAC;gBAAA;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAC/E,CAAC,eACNlQ,OAAA;kBAAK6P,SAAS,EAAC,WAAW;kBAAAC,QAAA,eACxB9P,OAAA;oBAAU6P,SAAS,EAAC,kBAAkB;oBAAC+B,KAAK,EAAExO,WAAY;oBAACyO,QAAQ,EAAG1M,CAAC,IAAK9B,cAAc,CAAC8B,CAAC,CAAC2M,MAAM,CAACF,KAAK,CAAE;oBAACtB,KAAK,EAAE;sBAAE4C,UAAU,EAAEpQ;oBAAW;kBAAE;oBAAAiN,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAE;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAC9I,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACH,CAAC,gBAENlQ,OAAA;gBAAK6P,SAAS,EAAC,eAAe;gBAAAC,QAAA,gBAC5B9P,OAAA;kBAAK6P,SAAS,EAAC,WAAW;kBAACS,KAAK,EAAE;oBAAEM,OAAO,EAAE,MAAM;oBAAEE,UAAU,EAAE,QAAQ;oBAAED,GAAG,EAAE;kBAAG,CAAE;kBAAAf,QAAA,gBACnF9P,OAAA;oBAAA8P,QAAA,EAAS1N,aAAa,CAACyD;kBAAK;oBAAAkK,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAS,CAAC,eACtClQ,OAAA;oBAAK6P,SAAS,EAAC,OAAO;oBAAAC,QAAA,EAAE,IAAI3G,IAAI,CAAC/G,aAAa,CAACwM,UAAU,CAAC,CAACyE,cAAc,CAAC;kBAAC;oBAAAtD,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAM,CAAC,eAClFlQ,OAAA;oBAAKsQ,KAAK,EAAE;sBAAE8C,UAAU,EAAE,MAAM;sBAAExC,OAAO,EAAE,MAAM;sBAAEC,GAAG,EAAE;oBAAE,CAAE;oBAAAf,QAAA,gBAC1D9P,OAAA;sBAAQ6P,SAAS,EAAC,YAAY;sBAACa,OAAO,EAAEA,CAAA,KAAMhL,SAAS,CAACtD,aAAa,CAAE;sBAAA0N,QAAA,EAAC;oBAAI;sBAAAC,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAQ,CAAC,eACrFlQ,OAAA;sBAAQ6P,SAAS,EAAC,YAAY;sBAACa,OAAO,EAAEA,CAAA,KAAMlK,WAAW,CAACpE,aAAa,CAACwD,QAAQ,CAAE;sBAAAkK,QAAA,EAAC;oBAAM;sBAAAC,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAQ,CAAC;kBAAA;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAC/F,CAAC;gBAAA;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACH,CAAC,eACNlQ,OAAA;kBAAK6P,SAAS,EAAC,WAAW;kBAAAC,QAAA,EACvB1N,aAAa,CAAC0D,OAAO,CAAC6B,KAAK,CAAC,IAAI,CAAC,CAACzB,GAAG,CAAC,CAACoN,EAAE,EAAEjG,CAAC,kBAC3CrN,OAAA;oBAAa6P,SAAS,EAAC,WAAW;oBAACS,KAAK,EAAE;sBAAE4C,UAAU,EAAEpQ;oBAAW,CAAE;oBAAAgN,QAAA,EAAEwD;kBAAE,GAA/DjG,CAAC;oBAAA0C,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAoE,CAChF;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACC,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACH,CACN,gBAEDlQ,OAAA;gBAAK6P,SAAS,EAAC,OAAO;gBAAAC,QAAA,EAAC;cAA8C;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAK;YAC3E;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,EACNuC,QAAQ,CAAC3H,IACX,CAAC,GACD,IAAI;EAAA;IAAAiF,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEZ;;AAEA;AAAAlP,EAAA,CAz2BwBL,UAAU;AAAA4S,EAAA,GAAV5S,UAAU;AA02BlC,SAAS6S,WAAWA,CAAC;EAAEC;AAA8C,CAAC,EAAE;EAAAC,GAAA;EACtE,MAAM,CAAC7N,KAAK,EAAE8N,QAAQ,CAAC,GAAGlU,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACqG,OAAO,EAAE8N,UAAU,CAAC,GAAGnU,QAAQ,CAAC,EAAE,CAAC;EAE1C,SAASoU,UAAUA,CAAA,EAAG;IACpB,IAAI,CAAChO,KAAK,CAAC4B,IAAI,CAAC,CAAC,IAAI,CAAC3B,OAAO,CAAC2B,IAAI,CAAC,CAAC,EAAE;IACtC,MAAM9B,KAAmB,GAAG;MAC1BC,QAAQ,EAAE,IAAIuD,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE;MAC1ByF,iBAAiB,EAAE,EAAE;MACrB9I,KAAK,EAAEA,KAAK,CAAC4B,IAAI,CAAC,CAAC,IAAI,UAAU;MACjC3B,OAAO,EAAEA,OAAO,CAAC2B,IAAI,CAAC,CAAC;MACvBmH,UAAU,EAAE,IAAIzF,IAAI,CAAC,CAAC,CAAC0F,WAAW,CAAC,CAAC;MACpCC,MAAM,EAAE;IACV,CAAC;IACD2E,MAAM,CAAC9N,KAAK,CAAC;IACbgO,QAAQ,CAAC,EAAE,CAAC;IACZC,UAAU,CAAC,EAAE,CAAC;EAChB;EAEA,oBACE5T,OAAA;IAAA8P,QAAA,gBACE9P,OAAA;MAAO6P,SAAS,EAAC,eAAe;MAACoD,WAAW,EAAC,OAAO;MAACrB,KAAK,EAAE/L,KAAM;MAACgM,QAAQ,EAAG1M,CAAC,IAAKwO,QAAQ,CAACxO,CAAC,CAAC2M,MAAM,CAACF,KAAK;IAAE;MAAA7B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eAChHlQ,OAAA;MAAU6P,SAAS,EAAC,kBAAkB;MAACoD,WAAW,EAAC,qBAAqB;MAACrB,KAAK,EAAE9L,OAAQ;MAAC+L,QAAQ,EAAG1M,CAAC,IAAKyO,UAAU,CAACzO,CAAC,CAAC2M,MAAM,CAACF,KAAK;IAAE;MAAA7B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACxIlQ,OAAA;MAAKsQ,KAAK,EAAE;QAAEM,OAAO,EAAE,MAAM;QAAEC,GAAG,EAAE;MAAE,CAAE;MAAAf,QAAA,eACtC9P,OAAA;QAAQ6P,SAAS,EAAC,YAAY;QAACa,OAAO,EAAEmD,UAAW;QAAA/D,QAAA,EAAC;MAAU;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACwD,GAAA,CA5BQF,WAAW;AAAAM,GAAA,GAAXN,WAAW;AAAA,IAAAD,EAAA,EAAAO,GAAA;AAAAC,YAAA,CAAAR,EAAA;AAAAQ,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}