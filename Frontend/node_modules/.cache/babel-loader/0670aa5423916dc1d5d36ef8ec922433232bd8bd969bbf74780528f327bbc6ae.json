{"ast":null,"code":"var _s = $RefreshSig$();\nimport { sessionSummaries } from \"../data/sessionSummaries\";\nimport { useEffect, useState } from \"react\";\nconst API_BASE = typeof window !== \"undefined\" && window.API_BASE || process.env.REACT_APP_API_BASE || \"http://localhost:8000\";\nconst getAuthHeader = () => {\n  try {\n    const t = localStorage.getItem('auth_token_fallback') || localStorage.getItem('token');\n    return t ? {\n      Authorization: `Bearer ${t}`\n    } : {};\n  } catch (e) {\n    return {};\n  }\n};\nexport function useSessionSummary(sessionId) {\n  _s();\n  const [summary, setSummary] = useState(null);\n  useEffect(() => {\n    let mounted = true;\n    if (!sessionId) {\n      setSummary(null);\n      return;\n    }\n    const fetchSummary = async () => {\n      try {\n        const uid = typeof window !== \"undefined\" ? localStorage.getItem(\"user_id\") : null;\n        if (!uid || uid.startsWith(\"anon_\")) {\n          // fallback to static summaries for anonymous users\n          const s = sessionSummaries.find(ss => ss.session_id === sessionId) || null;\n          setSummary(s);\n          return;\n        }\n\n        // sessionId is used as thread id in this app\n        const resp = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(uid)}/${encodeURIComponent(sessionId)}`, {\n          credentials: 'include',\n          headers: {\n            ...getAuthHeader()\n          }\n        });\n        if (!mounted) return;\n        if (!resp.ok) {\n          const s = sessionSummaries.find(ss => ss.session_id === sessionId) || null;\n          setSummary(s);\n          return;\n        }\n        const data = await resp.json();\n        const serverSummary = data.summary || null;\n        setSummary(serverSummary);\n      } catch (e) {\n        const s = sessionSummaries.find(ss => ss.session_id === sessionId) || null;\n        setSummary(s);\n      }\n    };\n\n    // initial fetch\n    void fetchSummary();\n\n    // re-fetch when user signs in/out\n    const handleUserChanged = () => {\n      void fetchSummary();\n    };\n    if (typeof window !== 'undefined') window.addEventListener('ai_user_changed', handleUserChanged);\n    return () => {\n      mounted = false;\n      if (typeof window !== 'undefined') window.removeEventListener('ai_user_changed', handleUserChanged);\n    };\n  }, [sessionId]);\n  return {\n    summary\n  };\n}\n_s(useSessionSummary, \"lKGhItSa883pfTQ2Pj3nIYHV1As=\");","map":{"version":3,"names":["sessionSummaries","useEffect","useState","API_BASE","window","process","env","REACT_APP_API_BASE","getAuthHeader","t","localStorage","getItem","Authorization","e","useSessionSummary","sessionId","_s","summary","setSummary","mounted","fetchSummary","uid","startsWith","s","find","ss","session_id","resp","fetch","encodeURIComponent","credentials","headers","ok","data","json","serverSummary","handleUserChanged","addEventListener","removeEventListener"],"sources":["/Users/ankurporwal/Documents/PersonalManagementAgent/Frontend/src/hooks/useSessionSummary.ts"],"sourcesContent":["import { sessionSummaries } from \"../data/sessionSummaries\";\nimport { SessionSummary } from \"../types/thinking\";\nimport { useEffect, useState } from \"react\";\n\nconst API_BASE = (typeof window !== \"undefined\" && (window as any).API_BASE) || (process.env.REACT_APP_API_BASE as string) || \"http://localhost:8000\";\nconst getAuthHeader = () => {\n  try { const t = localStorage.getItem('auth_token_fallback') || localStorage.getItem('token'); return t ? { Authorization: `Bearer ${t}` } : {}; } catch (e) { return {}; }\n};\n\nexport function useSessionSummary(sessionId?: string) {\n  const [summary, setSummary] = useState<SessionSummary | null>(null);\n\n  useEffect(() => {\n    let mounted = true;\n    if (!sessionId) {\n      setSummary(null);\n      return;\n    }\n\n    const fetchSummary = async () => {\n      try {\n        const uid = typeof window !== \"undefined\" ? localStorage.getItem(\"user_id\") : null;\n        if (!uid || uid.startsWith(\"anon_\")) {\n          // fallback to static summaries for anonymous users\n          const s = sessionSummaries.find((ss) => ss.session_id === sessionId) || null;\n          setSummary(s as SessionSummary | null);\n          return;\n        }\n\n        // sessionId is used as thread id in this app\n        const resp = await fetch(`${API_BASE}/summary/saved/${encodeURIComponent(uid)}/${encodeURIComponent(sessionId)}`, { credentials: 'include', headers: { ...(getAuthHeader()) } });\n        if (!mounted) return;\n        if (!resp.ok) {\n          const s = sessionSummaries.find((ss) => ss.session_id === sessionId) || null;\n          setSummary(s as SessionSummary | null);\n          return;\n        }\n        const data = await resp.json();\n        const serverSummary = data.summary || null;\n        setSummary(serverSummary as SessionSummary | null);\n      } catch (e) {\n        const s = sessionSummaries.find((ss) => ss.session_id === sessionId) || null;\n        setSummary(s as SessionSummary | null);\n      }\n    };\n\n    // initial fetch\n    void fetchSummary();\n\n    // re-fetch when user signs in/out\n    const handleUserChanged = () => { void fetchSummary(); };\n    if (typeof window !== 'undefined') window.addEventListener('ai_user_changed', handleUserChanged as EventListener);\n\n    return () => { mounted = false; if (typeof window !== 'undefined') window.removeEventListener('ai_user_changed', handleUserChanged as EventListener); };\n  }, [sessionId]);\n\n  return { summary };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}